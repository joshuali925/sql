<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Window Functions &#8212; sql-docs  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=12dfc556" />
    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="window-functions">
<h1>Window Functions<a class="headerlink" href="#window-functions" title="Link to this heading">¶</a></h1>
<p class="rubric">Table of contents</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id1">Overview</a></p>
<ul>
<li><p><a class="reference internal" href="#introduction" id="id2">Introduction</a></p></li>
<li><p><a class="reference internal" href="#syntax" id="id3">Syntax</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#aggregate-functions" id="id4">Aggregate Functions</a></p>
<ul>
<li><p><a class="reference internal" href="#count" id="id5">COUNT</a></p></li>
<li><p><a class="reference internal" href="#min" id="id6">MIN</a></p></li>
<li><p><a class="reference internal" href="#max" id="id7">MAX</a></p></li>
<li><p><a class="reference internal" href="#avg" id="id8">AVG</a></p></li>
<li><p><a class="reference internal" href="#sum" id="id9">SUM</a></p></li>
<li><p><a class="reference internal" href="#stddev-pop" id="id10">STDDEV_POP</a></p></li>
<li><p><a class="reference internal" href="#stddev-samp" id="id11">STDDEV_SAMP</a></p></li>
<li><p><a class="reference internal" href="#var-pop" id="id12">VAR_POP</a></p></li>
<li><p><a class="reference internal" href="#var-samp" id="id13">VAR_SAMP</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#ranking-functions" id="id14">Ranking Functions</a></p>
<ul>
<li><p><a class="reference internal" href="#determinism" id="id15">Determinism</a></p></li>
<li><p><a class="reference internal" href="#row-number" id="id16">ROW_NUMBER</a></p></li>
<li><p><a class="reference internal" href="#rank" id="id17">RANK</a></p></li>
<li><p><a class="reference internal" href="#dense-rank" id="id18">DENSE_RANK</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="overview">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Overview</a><a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<section id="introduction">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h3>
<p>A window function consists of 2 pieces: a function and a window definition. A window definition defines a window of data rows with a given scope around the current row. The window is also called window frame sometimes. In a window frame, the function performs a calculation across the set of data and generate a result value for each row.</p>
<p>There are three categories of common window functions:</p>
<ol class="arabic simple">
<li><p><strong>Aggregate Functions</strong>: COUNT(), MIN(), MAX(), AVG(), SUM(), STDDEV_POP, STDDEV_SAMP, VAR_POP and VAR_SAMP.</p></li>
<li><p><strong>Ranking Functions</strong>: ROW_NUMBER(), RANK(), DENSE_RANK(), PERCENT_RANK() and NTILE().</p></li>
<li><p><strong>Analytic Functions</strong>: CUME_DIST(), LAG() and LEAD().</p></li>
</ol>
</section>
<section id="syntax">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Syntax</a><a class="headerlink" href="#syntax" title="Link to this heading">¶</a></h3>
<p>The syntax of a window function is as follows in which both <code class="docutils literal notranslate"><span class="pre">PARTITION</span> <span class="pre">BY</span></code> and <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> clause are optional:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function_name</span> <span class="p">(</span><span class="n">expression</span> <span class="p">[,</span> <span class="n">expression</span><span class="o">...</span><span class="p">])</span>
<span class="n">OVER</span> <span class="p">(</span>
  <span class="n">PARTITION</span> <span class="n">BY</span> <span class="n">expression</span> <span class="p">[,</span> <span class="n">expression</span><span class="o">...</span><span class="p">]</span>
  <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">expression</span> <span class="p">[</span><span class="n">ASC</span> <span class="o">|</span> <span class="n">DESC</span><span class="p">]</span> <span class="p">[</span><span class="n">NULLS</span> <span class="p">{</span><span class="n">FIRST</span> <span class="o">|</span> <span class="n">LAST</span><span class="p">}]</span> <span class="p">[,</span> <span class="o">...</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="aggregate-functions">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Aggregate Functions</a><a class="headerlink" href="#aggregate-functions" title="Link to this heading">¶</a></h2>
<p>Aggregate functions are window functions that operates on a cumulative window frame to calculate an aggregated result. How cumulative data in the window frame being aggregated is exactly same as how regular aggregate functions work. So aggregate window functions can be used to perform running calculation easily, for example running average or running sum. Note that if <code class="docutils literal notranslate"><span class="pre">PARTITION</span> <span class="pre">BY</span></code> clause present and specified column value(s) changed, the state of aggregate function will be reset.</p>
<section id="count">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">COUNT</a><a class="headerlink" href="#count" title="Link to this heading">¶</a></h3>
<p>Here is an example for <code class="docutils literal notranslate"><span class="pre">COUNT</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">&gt;</span> <span class="n">SELECT</span>
<span class="o">...</span>   <span class="n">gender</span><span class="p">,</span> <span class="n">balance</span><span class="p">,</span>
<span class="o">...</span>   <span class="n">COUNT</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">PARTITION</span> <span class="n">BY</span> <span class="n">gender</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">balance</span>
<span class="o">...</span> <span class="p">)</span> <span class="n">AS</span> <span class="n">cnt</span>
<span class="o">...</span> <span class="n">FROM</span> <span class="n">accounts</span><span class="p">;</span>
<span class="n">fetched</span> <span class="n">rows</span> <span class="o">/</span> <span class="n">total</span> <span class="n">rows</span> <span class="o">=</span> <span class="mi">4</span><span class="o">/</span><span class="mi">4</span>
<span class="o">+----------+-----------+-------+</span>
<span class="o">|</span> <span class="n">gender</span>   <span class="o">|</span> <span class="n">balance</span>   <span class="o">|</span> <span class="n">cnt</span>   <span class="o">|</span>
<span class="o">|----------+-----------+-------|</span>
<span class="o">|</span> <span class="n">F</span>        <span class="o">|</span> <span class="mi">32838</span>     <span class="o">|</span> <span class="mi">1</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">4180</span>      <span class="o">|</span> <span class="mi">1</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">5686</span>      <span class="o">|</span> <span class="mi">2</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">39225</span>     <span class="o">|</span> <span class="mi">3</span>     <span class="o">|</span>
<span class="o">+----------+-----------+-------+</span>
</pre></div>
</div>
</section>
<section id="min">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">MIN</a><a class="headerlink" href="#min" title="Link to this heading">¶</a></h3>
<p>Here is an example for <code class="docutils literal notranslate"><span class="pre">MIN</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">&gt;</span> <span class="n">SELECT</span>
<span class="o">...</span>   <span class="n">gender</span><span class="p">,</span> <span class="n">balance</span><span class="p">,</span>
<span class="o">...</span>   <span class="n">MIN</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">PARTITION</span> <span class="n">BY</span> <span class="n">gender</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">balance</span>
<span class="o">...</span> <span class="p">)</span> <span class="n">AS</span> <span class="n">cnt</span>
<span class="o">...</span> <span class="n">FROM</span> <span class="n">accounts</span><span class="p">;</span>
<span class="n">fetched</span> <span class="n">rows</span> <span class="o">/</span> <span class="n">total</span> <span class="n">rows</span> <span class="o">=</span> <span class="mi">4</span><span class="o">/</span><span class="mi">4</span>
<span class="o">+----------+-----------+-------+</span>
<span class="o">|</span> <span class="n">gender</span>   <span class="o">|</span> <span class="n">balance</span>   <span class="o">|</span> <span class="n">cnt</span>   <span class="o">|</span>
<span class="o">|----------+-----------+-------|</span>
<span class="o">|</span> <span class="n">F</span>        <span class="o">|</span> <span class="mi">32838</span>     <span class="o">|</span> <span class="mi">32838</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">4180</span>      <span class="o">|</span> <span class="mi">4180</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">5686</span>      <span class="o">|</span> <span class="mi">4180</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">39225</span>     <span class="o">|</span> <span class="mi">4180</span>  <span class="o">|</span>
<span class="o">+----------+-----------+-------+</span>
</pre></div>
</div>
</section>
<section id="max">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">MAX</a><a class="headerlink" href="#max" title="Link to this heading">¶</a></h3>
<p>Here is an example for <code class="docutils literal notranslate"><span class="pre">MAX</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">&gt;</span> <span class="n">SELECT</span>
<span class="o">...</span>   <span class="n">gender</span><span class="p">,</span> <span class="n">balance</span><span class="p">,</span>
<span class="o">...</span>   <span class="n">MAX</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">PARTITION</span> <span class="n">BY</span> <span class="n">gender</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">balance</span>
<span class="o">...</span> <span class="p">)</span> <span class="n">AS</span> <span class="n">cnt</span>
<span class="o">...</span> <span class="n">FROM</span> <span class="n">accounts</span><span class="p">;</span>
<span class="n">fetched</span> <span class="n">rows</span> <span class="o">/</span> <span class="n">total</span> <span class="n">rows</span> <span class="o">=</span> <span class="mi">4</span><span class="o">/</span><span class="mi">4</span>
<span class="o">+----------+-----------+-------+</span>
<span class="o">|</span> <span class="n">gender</span>   <span class="o">|</span> <span class="n">balance</span>   <span class="o">|</span> <span class="n">cnt</span>   <span class="o">|</span>
<span class="o">|----------+-----------+-------|</span>
<span class="o">|</span> <span class="n">F</span>        <span class="o">|</span> <span class="mi">32838</span>     <span class="o">|</span> <span class="mi">32838</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">4180</span>      <span class="o">|</span> <span class="mi">4180</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">5686</span>      <span class="o">|</span> <span class="mi">5686</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">39225</span>     <span class="o">|</span> <span class="mi">39225</span> <span class="o">|</span>
<span class="o">+----------+-----------+-------+</span>
</pre></div>
</div>
</section>
<section id="avg">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">AVG</a><a class="headerlink" href="#avg" title="Link to this heading">¶</a></h3>
<p>Here is an example for <code class="docutils literal notranslate"><span class="pre">AVG</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">&gt;</span> <span class="n">SELECT</span>
<span class="o">...</span>   <span class="n">gender</span><span class="p">,</span> <span class="n">balance</span><span class="p">,</span>
<span class="o">...</span>   <span class="n">AVG</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">PARTITION</span> <span class="n">BY</span> <span class="n">gender</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">balance</span>
<span class="o">...</span> <span class="p">)</span> <span class="n">AS</span> <span class="n">cnt</span>
<span class="o">...</span> <span class="n">FROM</span> <span class="n">accounts</span><span class="p">;</span>
<span class="n">fetched</span> <span class="n">rows</span> <span class="o">/</span> <span class="n">total</span> <span class="n">rows</span> <span class="o">=</span> <span class="mi">4</span><span class="o">/</span><span class="mi">4</span>
<span class="o">+----------+-----------+--------------------+</span>
<span class="o">|</span> <span class="n">gender</span>   <span class="o">|</span> <span class="n">balance</span>   <span class="o">|</span> <span class="n">cnt</span>                <span class="o">|</span>
<span class="o">|----------+-----------+--------------------|</span>
<span class="o">|</span> <span class="n">F</span>        <span class="o">|</span> <span class="mi">32838</span>     <span class="o">|</span> <span class="mf">32838.0</span>            <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">4180</span>      <span class="o">|</span> <span class="mf">4180.0</span>             <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">5686</span>      <span class="o">|</span> <span class="mf">4933.0</span>             <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">39225</span>     <span class="o">|</span> <span class="mf">16363.666666666666</span> <span class="o">|</span>
<span class="o">+----------+-----------+--------------------+</span>
</pre></div>
</div>
</section>
<section id="sum">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">SUM</a><a class="headerlink" href="#sum" title="Link to this heading">¶</a></h3>
<p>Here is an example for <code class="docutils literal notranslate"><span class="pre">SUM</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">&gt;</span> <span class="n">SELECT</span>
<span class="o">...</span>   <span class="n">gender</span><span class="p">,</span> <span class="n">balance</span><span class="p">,</span>
<span class="o">...</span>   <span class="n">SUM</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">PARTITION</span> <span class="n">BY</span> <span class="n">gender</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">balance</span>
<span class="o">...</span> <span class="p">)</span> <span class="n">AS</span> <span class="n">cnt</span>
<span class="o">...</span> <span class="n">FROM</span> <span class="n">accounts</span><span class="p">;</span>
<span class="n">fetched</span> <span class="n">rows</span> <span class="o">/</span> <span class="n">total</span> <span class="n">rows</span> <span class="o">=</span> <span class="mi">4</span><span class="o">/</span><span class="mi">4</span>
<span class="o">+----------+-----------+-------+</span>
<span class="o">|</span> <span class="n">gender</span>   <span class="o">|</span> <span class="n">balance</span>   <span class="o">|</span> <span class="n">cnt</span>   <span class="o">|</span>
<span class="o">|----------+-----------+-------|</span>
<span class="o">|</span> <span class="n">F</span>        <span class="o">|</span> <span class="mi">32838</span>     <span class="o">|</span> <span class="mi">32838</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">4180</span>      <span class="o">|</span> <span class="mi">4180</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">5686</span>      <span class="o">|</span> <span class="mi">9866</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">39225</span>     <span class="o">|</span> <span class="mi">49091</span> <span class="o">|</span>
<span class="o">+----------+-----------+-------+</span>
</pre></div>
</div>
</section>
<section id="stddev-pop">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">STDDEV_POP</a><a class="headerlink" href="#stddev-pop" title="Link to this heading">¶</a></h3>
<p>Here is an example for <code class="docutils literal notranslate"><span class="pre">STDDEV_POP</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">&gt;</span> <span class="n">SELECT</span>
<span class="o">...</span>   <span class="n">gender</span><span class="p">,</span> <span class="n">balance</span><span class="p">,</span>
<span class="o">...</span>   <span class="n">STDDEV_POP</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">PARTITION</span> <span class="n">BY</span> <span class="n">gender</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">balance</span>
<span class="o">...</span> <span class="p">)</span> <span class="n">AS</span> <span class="n">val</span>
<span class="o">...</span> <span class="n">FROM</span> <span class="n">accounts</span><span class="p">;</span>
<span class="n">fetched</span> <span class="n">rows</span> <span class="o">/</span> <span class="n">total</span> <span class="n">rows</span> <span class="o">=</span> <span class="mi">4</span><span class="o">/</span><span class="mi">4</span>
<span class="o">+----------+-----------+--------------------+</span>
<span class="o">|</span> <span class="n">gender</span>   <span class="o">|</span> <span class="n">balance</span>   <span class="o">|</span> <span class="n">val</span>                <span class="o">|</span>
<span class="o">|----------+-----------+--------------------|</span>
<span class="o">|</span> <span class="n">F</span>        <span class="o">|</span> <span class="mi">32838</span>     <span class="o">|</span> <span class="mf">0.0</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">4180</span>      <span class="o">|</span> <span class="mf">0.0</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">5686</span>      <span class="o">|</span> <span class="mf">753.0</span>              <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">39225</span>     <span class="o">|</span> <span class="mf">16177.091422406222</span> <span class="o">|</span>
<span class="o">+----------+-----------+--------------------+</span>
</pre></div>
</div>
</section>
<section id="stddev-samp">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">STDDEV_SAMP</a><a class="headerlink" href="#stddev-samp" title="Link to this heading">¶</a></h3>
<p>Here is an example for <code class="docutils literal notranslate"><span class="pre">STDDEV_SAMP</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">&gt;</span> <span class="n">SELECT</span>
<span class="o">...</span>   <span class="n">gender</span><span class="p">,</span> <span class="n">balance</span><span class="p">,</span>
<span class="o">...</span>   <span class="n">STDDEV_SAMP</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">PARTITION</span> <span class="n">BY</span> <span class="n">gender</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">balance</span>
<span class="o">...</span> <span class="p">)</span> <span class="n">AS</span> <span class="n">val</span>
<span class="o">...</span> <span class="n">FROM</span> <span class="n">accounts</span><span class="p">;</span>
<span class="n">fetched</span> <span class="n">rows</span> <span class="o">/</span> <span class="n">total</span> <span class="n">rows</span> <span class="o">=</span> <span class="mi">4</span><span class="o">/</span><span class="mi">4</span>
<span class="o">+----------+-----------+--------------------+</span>
<span class="o">|</span> <span class="n">gender</span>   <span class="o">|</span> <span class="n">balance</span>   <span class="o">|</span> <span class="n">val</span>                <span class="o">|</span>
<span class="o">|----------+-----------+--------------------|</span>
<span class="o">|</span> <span class="n">F</span>        <span class="o">|</span> <span class="mi">32838</span>     <span class="o">|</span> <span class="mf">0.0</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">4180</span>      <span class="o">|</span> <span class="mf">0.0</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">5686</span>      <span class="o">|</span> <span class="mf">1064.9028124669405</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">39225</span>     <span class="o">|</span> <span class="mf">19812.809753624886</span> <span class="o">|</span>
<span class="o">+----------+-----------+--------------------+</span>
</pre></div>
</div>
</section>
<section id="var-pop">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">VAR_POP</a><a class="headerlink" href="#var-pop" title="Link to this heading">¶</a></h3>
<p>Here is an example for <code class="docutils literal notranslate"><span class="pre">SUM</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">&gt;</span> <span class="n">SELECT</span>
<span class="o">...</span>   <span class="n">gender</span><span class="p">,</span> <span class="n">balance</span><span class="p">,</span>
<span class="o">...</span>   <span class="n">VAR_POP</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">PARTITION</span> <span class="n">BY</span> <span class="n">gender</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">balance</span>
<span class="o">...</span> <span class="p">)</span> <span class="n">AS</span> <span class="n">val</span>
<span class="o">...</span> <span class="n">FROM</span> <span class="n">accounts</span><span class="p">;</span>
<span class="n">fetched</span> <span class="n">rows</span> <span class="o">/</span> <span class="n">total</span> <span class="n">rows</span> <span class="o">=</span> <span class="mi">4</span><span class="o">/</span><span class="mi">4</span>
<span class="o">+----------+-----------+--------------------+</span>
<span class="o">|</span> <span class="n">gender</span>   <span class="o">|</span> <span class="n">balance</span>   <span class="o">|</span> <span class="n">val</span>                <span class="o">|</span>
<span class="o">|----------+-----------+--------------------|</span>
<span class="o">|</span> <span class="n">F</span>        <span class="o">|</span> <span class="mi">32838</span>     <span class="o">|</span> <span class="mf">0.0</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">4180</span>      <span class="o">|</span> <span class="mf">0.0</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">5686</span>      <span class="o">|</span> <span class="mf">567009.0</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">39225</span>     <span class="o">|</span> <span class="mf">261698286.88888893</span> <span class="o">|</span>
<span class="o">+----------+-----------+--------------------+</span>
</pre></div>
</div>
</section>
<section id="var-samp">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">VAR_SAMP</a><a class="headerlink" href="#var-samp" title="Link to this heading">¶</a></h3>
<p>Here is an example for <code class="docutils literal notranslate"><span class="pre">SUM</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">&gt;</span> <span class="n">SELECT</span>
<span class="o">...</span>   <span class="n">gender</span><span class="p">,</span> <span class="n">balance</span><span class="p">,</span>
<span class="o">...</span>   <span class="n">VAR_SAMP</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">PARTITION</span> <span class="n">BY</span> <span class="n">gender</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">balance</span>
<span class="o">...</span> <span class="p">)</span> <span class="n">AS</span> <span class="n">val</span>
<span class="o">...</span> <span class="n">FROM</span> <span class="n">accounts</span><span class="p">;</span>
<span class="n">fetched</span> <span class="n">rows</span> <span class="o">/</span> <span class="n">total</span> <span class="n">rows</span> <span class="o">=</span> <span class="mi">4</span><span class="o">/</span><span class="mi">4</span>
<span class="o">+----------+-----------+-------------------+</span>
<span class="o">|</span> <span class="n">gender</span>   <span class="o">|</span> <span class="n">balance</span>   <span class="o">|</span> <span class="n">val</span>               <span class="o">|</span>
<span class="o">|----------+-----------+-------------------|</span>
<span class="o">|</span> <span class="n">F</span>        <span class="o">|</span> <span class="mi">32838</span>     <span class="o">|</span> <span class="mf">0.0</span>               <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">4180</span>      <span class="o">|</span> <span class="mf">0.0</span>               <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">5686</span>      <span class="o">|</span> <span class="mf">1134018.0</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">39225</span>     <span class="o">|</span> <span class="mf">392547430.3333334</span> <span class="o">|</span>
<span class="o">+----------+-----------+-------------------+</span>
</pre></div>
</div>
</section>
</section>
<section id="ranking-functions">
<h2><a class="toc-backref" href="#id14" role="doc-backlink">Ranking Functions</a><a class="headerlink" href="#ranking-functions" title="Link to this heading">¶</a></h2>
<p>Ranking functions are window functions that assign an incremental rank to each row in the window. How the rank number gets increased is up to ranking function implementation, though the rank is mostly determined by field values in <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> list. If <code class="docutils literal notranslate"><span class="pre">PARTITION</span> <span class="pre">BY</span></code> clause present, the state of ranking functions (incremental rank number maintained) will be reset.</p>
<section id="determinism">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">Determinism</a><a class="headerlink" href="#determinism" title="Link to this heading">¶</a></h3>
<p>Note that normally ranking functions are supposed to be used with window definition that defines the order of data rows in the window. Otherwise the result is undetermined. In this case, <code class="docutils literal notranslate"><span class="pre">ROW_NUMBER</span></code> assigns row number to data rows in random order. <code class="docutils literal notranslate"><span class="pre">RANK</span></code> and <code class="docutils literal notranslate"><span class="pre">DENSE_RANK</span></code> always assigns rank 1 to each row.</p>
</section>
<section id="row-number">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">ROW_NUMBER</a><a class="headerlink" href="#row-number" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ROW_NUMBER</span></code> function assigns a row number to each row. As a special case, the row number is always increased by one regardless of the fields specified in <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> list. Here is an example for <code class="docutils literal notranslate"><span class="pre">ROW_NUMBER</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="n">gender</span><span class="p">,</span> <span class="n">balance</span><span class="p">,</span> <span class="n">ROW_NUMBER</span><span class="p">()</span> <span class="n">OVER</span><span class="p">(</span><span class="n">PARTITION</span> <span class="n">BY</span> <span class="n">gender</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">balance</span><span class="p">)</span> <span class="n">AS</span> <span class="n">num</span> <span class="n">FROM</span> <span class="n">accounts</span><span class="p">;</span>
<span class="n">fetched</span> <span class="n">rows</span> <span class="o">/</span> <span class="n">total</span> <span class="n">rows</span> <span class="o">=</span> <span class="mi">4</span><span class="o">/</span><span class="mi">4</span>
<span class="o">+----------+-----------+-------+</span>
<span class="o">|</span> <span class="n">gender</span>   <span class="o">|</span> <span class="n">balance</span>   <span class="o">|</span> <span class="n">num</span>   <span class="o">|</span>
<span class="o">|----------+-----------+-------|</span>
<span class="o">|</span> <span class="n">F</span>        <span class="o">|</span> <span class="mi">32838</span>     <span class="o">|</span> <span class="mi">1</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">4180</span>      <span class="o">|</span> <span class="mi">1</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">5686</span>      <span class="o">|</span> <span class="mi">2</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">39225</span>     <span class="o">|</span> <span class="mi">3</span>     <span class="o">|</span>
<span class="o">+----------+-----------+-------+</span>
</pre></div>
</div>
<p>Similarly as regular <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> clause, you can specify null ordering by <code class="docutils literal notranslate"><span class="pre">NULLS</span> <span class="pre">FIRST</span></code> or <code class="docutils literal notranslate"><span class="pre">NULLS</span> <span class="pre">LAST</span></code> which has exactly same behavior:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">&gt;</span> <span class="n">SELECT</span>
<span class="o">...</span>  <span class="n">employer</span><span class="p">,</span>
<span class="o">...</span>  <span class="n">ROW_NUMBER</span><span class="p">()</span> <span class="n">OVER</span><span class="p">(</span>
<span class="o">...</span>   <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">employer</span> <span class="n">NULLS</span> <span class="n">LAST</span>
<span class="o">...</span> <span class="p">)</span> <span class="n">AS</span> <span class="n">num</span>
<span class="o">...</span> <span class="n">FROM</span> <span class="n">accounts</span>
<span class="o">...</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">employer</span> <span class="n">NULLS</span> <span class="n">LAST</span><span class="p">;</span>
<span class="n">fetched</span> <span class="n">rows</span> <span class="o">/</span> <span class="n">total</span> <span class="n">rows</span> <span class="o">=</span> <span class="mi">4</span><span class="o">/</span><span class="mi">4</span>
<span class="o">+------------+-------+</span>
<span class="o">|</span> <span class="n">employer</span>   <span class="o">|</span> <span class="n">num</span>   <span class="o">|</span>
<span class="o">|------------+-------|</span>
<span class="o">|</span> <span class="n">Netagy</span>     <span class="o">|</span> <span class="mi">1</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">Pyrami</span>     <span class="o">|</span> <span class="mi">2</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">Quility</span>    <span class="o">|</span> <span class="mi">3</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">null</span>       <span class="o">|</span> <span class="mi">4</span>     <span class="o">|</span>
<span class="o">+------------+-------+</span>
</pre></div>
</div>
</section>
<section id="rank">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">RANK</a><a class="headerlink" href="#rank" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">RANK</span></code> function assigns a rank to each row. For rows that have same values for fields specified in <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> list, same rank is assigned. If this is the case, the next few ranks will be skipped depending on how many ties. Here is an example for <code class="docutils literal notranslate"><span class="pre">RANK</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="n">gender</span><span class="p">,</span> <span class="n">RANK</span><span class="p">()</span> <span class="n">OVER</span><span class="p">(</span><span class="n">ORDER</span> <span class="n">BY</span> <span class="n">gender</span> <span class="n">DESC</span><span class="p">)</span> <span class="n">AS</span> <span class="n">rnk</span> <span class="n">FROM</span> <span class="n">accounts</span><span class="p">;</span>
<span class="n">fetched</span> <span class="n">rows</span> <span class="o">/</span> <span class="n">total</span> <span class="n">rows</span> <span class="o">=</span> <span class="mi">4</span><span class="o">/</span><span class="mi">4</span>
<span class="o">+----------+-------+</span>
<span class="o">|</span> <span class="n">gender</span>   <span class="o">|</span> <span class="n">rnk</span>   <span class="o">|</span>
<span class="o">|----------+-------|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">1</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">1</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">1</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">F</span>        <span class="o">|</span> <span class="mi">4</span>     <span class="o">|</span>
<span class="o">+----------+-------+</span>
</pre></div>
</div>
</section>
<section id="dense-rank">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">DENSE_RANK</a><a class="headerlink" href="#dense-rank" title="Link to this heading">¶</a></h3>
<p>Similarly as <code class="docutils literal notranslate"><span class="pre">RANK</span></code>, <code class="docutils literal notranslate"><span class="pre">DENSE_RANK</span></code> function also assigns a rank to each row. The difference is there is no gap between ranks. Here is an example for <code class="docutils literal notranslate"><span class="pre">DENSE_RANK</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="n">gender</span><span class="p">,</span> <span class="n">DENSE_RANK</span><span class="p">()</span> <span class="n">OVER</span><span class="p">(</span><span class="n">ORDER</span> <span class="n">BY</span> <span class="n">gender</span> <span class="n">DESC</span><span class="p">)</span> <span class="n">AS</span> <span class="n">rnk</span> <span class="n">FROM</span> <span class="n">accounts</span><span class="p">;</span>
<span class="n">fetched</span> <span class="n">rows</span> <span class="o">/</span> <span class="n">total</span> <span class="n">rows</span> <span class="o">=</span> <span class="mi">4</span><span class="o">/</span><span class="mi">4</span>
<span class="o">+----------+-------+</span>
<span class="o">|</span> <span class="n">gender</span>   <span class="o">|</span> <span class="n">rnk</span>   <span class="o">|</span>
<span class="o">|----------+-------|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">1</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">1</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">1</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">F</span>        <span class="o">|</span> <span class="mi">2</span>     <span class="o">|</span>
<span class="o">+----------+-------+</span>
</pre></div>
</div>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">sql-docs</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, josh.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../../../_sources/docs/user/dql/window.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>