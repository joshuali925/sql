<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>What’s OpenSearch SQL? &#8212; sql-docs  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>This project is based on the Apache 2.0-licensed <a class="reference external" href="https://github.com/NLPchina/elasticsearch-sql">elasticsearch-sql</a> project. Thank you <a class="reference external" href="https://github.com/eliranmoyal">eliranmoyal</a>, <a class="reference external" href="https://github.com/shi-yuan">shi-yuan</a>, <a class="reference external" href="https://github.com/ansjsun">ansjsun</a> and everyone else who contributed great code to that project.</p>
<section id="whats-opensearch-sql">
<h1>What’s OpenSearch SQL?<a class="headerlink" href="#whats-opensearch-sql" title="Link to this heading">¶</a></h1>
<p>The OpenSearch plugin lets you write queries in SQL rather than the OpenSearch query domain-specific language (DSL). While the majority of our codebase is on top of ES-SQL initially, there are a lot of new features and bug fixes introduced in our implementation. And in the following releases this year, we keep improving and refactoring our code as well as maintaining version currency of OpenSearch. Basically OpenSearch SQL is superset of ES-SQL and it’s more reliable and up-to-date.</p>
</section>
<section id="the-problems-we-found-in-nlpchina-es-sql">
<h1>The problems we found in NLPchina-ES-SQL.<a class="headerlink" href="#the-problems-we-found-in-nlpchina-es-sql" title="Link to this heading">¶</a></h1>
<p>The ES-SQL codebase has clear architecture and abstraction for a basic query engine, such as SQL parser, DSL generator and domain model. However as we dived deep, we identified the following major problems and resolved them before launch:</p>
<ol class="arabic simple">
<li><p>The JDBC driver used Elasticsearch proprietary API <code class="docutils literal notranslate"><span class="pre">PreBuiltXPackTransportClient</span></code>.</p></li>
<li><p>JOIN capability matters but the Hash JOIN implementation was not scalable for production use because it loads all data into memory.</p></li>
<li><p>For complex queries like JOIN or Multi-query, there was no concept of a query plan for planning and optimizing.</p></li>
<li><p>ES-SQL uses a handwritten SQL parser Druid which is not extensible, so many queries that not supported or has semantical error can still pass the parsing but ended up throwing runtime error.</p></li>
</ol>
</section>
<section id="what-major-improvements-we-made">
<h1>What major improvements we made?<a class="headerlink" href="#what-major-improvements-we-made" title="Link to this heading">¶</a></h1>
<p>Apart from the problems we identified earlier, we made significant improvement in terms of functionality and reliability:</p>
<ol class="arabic simple">
<li><p><em>Integration Test</em>: We migrated all integrate tests to standard OpenSearch IT framework which spins up in-memory cluster for testing. Now all test cases treat plugin code as blackbox and verify functionality from externally.</p></li>
<li><p><em>New JDBC Driver</em>: We developed our own JDBC driver without any dependency on Elasticsearch proprietary code.
<a class="reference external" href="https://github.com/opensearch-project/sql/tree/main/sql-jdbc">sql-jdbc</a></p></li>
<li><p><em>Better Hash JOIN</em>: Block Hash Join implementation with circuit break mechanism protect your OpenSearch memory. Performance testing showed our implementation is 1.5 ~ 2x better than old hash join in terms of throughput and latency and much lower error rate under heavy pressure.</p></li>
<li><p><em>Query Planner</em>: Logical and physical planner was added to support JOIN query in efficient and extendible way.</p></li>
<li><p><em>PartiQL Compatibility</em>: we are partially compatible with PartiQL specification which allows for query involved in nested JSON documents.</p></li>
<li><p><em>New ANTLR Parser</em>: A new ANTLR4 parser was generated from grammar based on what we support along with a new semantic analyzer to perform scope and type checking.</p></li>
</ol>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">sql-docs</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, josh.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../_sources/docs/attributions.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>