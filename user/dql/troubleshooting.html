<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Troubleshooting &#8212; Example 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=12dfc556" />
    <script src="../../_static/documentation_options.js?v=2709fde1"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="troubleshooting">
<h1>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#narrative" id="id2">Narrative</a></p>
<ul>
<li><p><a class="reference internal" href="#syntax-analysis-semantic-analysis-exceptions" id="id3">Syntax Analysis / Semantic Analysis Exceptions</a></p></li>
<li><p><a class="reference internal" href="#index-mapping-verification-exception" id="id4">Index Mapping Verification Exception</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="narrative">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Narrative</a><a class="headerlink" href="#narrative" title="Link to this heading">¶</a></h2>
<p>SQL plugin is stateless for now so mostly the troubleshooting is focused on why a single query fails.</p>
<section id="syntax-analysis-semantic-analysis-exceptions">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Syntax Analysis / Semantic Analysis Exceptions</a><a class="headerlink" href="#syntax-analysis-semantic-analysis-exceptions" title="Link to this heading">¶</a></h3>
<p><strong>Symptoms</strong></p>
<p>When you end up with exceptions similar to as follows:</p>
<p>Query:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="err">POST</span><span class="w"> </span><span class="err">/_plugi</span><span class="kc">ns</span><span class="err">/_sql</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SELECT * FROM sample:data&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Result:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;reason&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Invalid SQL query&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;details&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Failed to parse query due to offending symbol [:] at: &#39;SELECT * FROM xxx WHERE xxx:&#39; &lt;--- HERE...</span>
<span class="s2">    More details: Expecting tokens in {&lt;EOF&gt;, &#39;AND&#39;, &#39;BETWEEN&#39;, &#39;GROUP&#39;, &#39;HAVING&#39;, &#39;IN&#39;, &#39;IS&#39;, &#39;LIKE&#39;, &#39;LIMIT&#39;,</span>
<span class="s2">    &#39;NOT&#39;, &#39;OR&#39;, &#39;ORDER&#39;, &#39;REGEXP&#39;, &#39;*&#39;, &#39;/&#39;, &#39;%&#39;, &#39;+&#39;, &#39;-&#39;, &#39;DIV&#39;, &#39;MOD&#39;, &#39;=&#39;, &#39;&gt;&#39;, &#39;&lt;&#39;, &#39;!&#39;,</span>
<span class="s2">    &#39;|&#39;, &#39;&amp;&#39;, &#39;^&#39;, &#39;.&#39;, DOT_ID}&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SyntaxAnalysisException&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Workaround</strong></p>
<p>You need to confirm if the syntax is not supported and disable query analysis if that’s the case by the following steps:</p>
<ol class="arabic simple">
<li><p>Check if there is any identifier (e.g. index name, column name etc.) that contains special characters (e.g. “.”, “ “, “&amp;”, “&#64;”,…). The SQL parser gets confused when parsing these characters within the identifiers and throws exception. If you do have such identifiers, try to quote them with backticks to pass the syntax and semantic analysis. For example, assume the index name in the query above is “sample:data” but the plugin fails the analysis, you may well try:</p></li>
</ol>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="err">POST</span><span class="w"> </span><span class="err">/_plugi</span><span class="kc">ns</span><span class="err">/_sql</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;query&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SELECT * FROM `sample:data`&quot;</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>Go to the step 2 if not working.</p>
<ol class="arabic simple" start="2">
<li><p>Identify syntax error in failed query, and correct the syntax if the query does not follow MySQL grammar. Go to step 3 if your query is correct in syntax but it still ends up syntax exception.</p></li>
<li><p>Disable strict query analysis in new ANTLR parser with the following code block.</p></li>
<li><p>Verify if the query can pass now. If the query fails as well, please create an issue in our <a class="reference external" href="https://github.com/opensearch-project/sql/issues">GitHub Issues</a> section to report bugs fixing or request new features.</p></li>
</ol>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="err">#Disable</span><span class="w"> </span><span class="err">query</span><span class="w"> </span><span class="err">a</span><span class="kc">nal</span><span class="err">ysis</span>
<span class="err">curl</span><span class="w"> </span><span class="mi">-</span><span class="err">H</span><span class="w"> </span><span class="err">&#39;Co</span><span class="kc">ntent</span><span class="mi">-</span><span class="err">Type</span><span class="p">:</span><span class="w"> </span><span class="err">applica</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="err">/jso</span><span class="kc">n</span><span class="err">&#39;</span><span class="w"> </span><span class="mi">-</span><span class="err">X</span><span class="w"> </span><span class="err">PUT</span><span class="w"> </span><span class="err">localhos</span><span class="kc">t</span><span class="p">:</span><span class="mi">9200</span><span class="err">/_clus</span><span class="kc">ter</span><span class="err">/se</span><span class="kc">tt</span><span class="err">i</span><span class="kc">n</span><span class="err">gs</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;persistent&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;opensearch.sql.query.analysis.enabled&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span><span class="err">&#39;</span>

<span class="err">#Veri</span><span class="kc">f</span><span class="err">y</span><span class="w"> </span><span class="err">i</span><span class="kc">f</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">query</span><span class="w"> </span><span class="err">ca</span><span class="kc">n</span><span class="w"> </span><span class="err">pass</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">veri</span><span class="kc">f</span><span class="err">ica</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="kc">n</span><span class="err">ow</span>
<span class="err">curl</span><span class="w"> </span><span class="mi">-</span><span class="err">H</span><span class="w"> </span><span class="err">&#39;Co</span><span class="kc">ntent</span><span class="mi">-</span><span class="err">Type</span><span class="p">:</span><span class="w"> </span><span class="err">applica</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="err">/jso</span><span class="kc">n</span><span class="err">&#39;</span><span class="w"> </span><span class="mi">-</span><span class="err">X</span><span class="w"> </span><span class="err">POST</span><span class="w"> </span><span class="err">localhos</span><span class="kc">t</span><span class="p">:</span><span class="mi">9200</span><span class="err">/_plugi</span><span class="kc">ns</span><span class="err">/_sql</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SELECT * FROM ...&quot;</span>
<span class="p">}</span><span class="err">&#39;</span>
</pre></div>
</div>
</section>
<section id="index-mapping-verification-exception">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Index Mapping Verification Exception</a><a class="headerlink" href="#index-mapping-verification-exception" title="Link to this heading">¶</a></h3>
<p><strong>Symptoms</strong></p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;reason&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;There was internal problem at backend&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;details&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;When using multiple indices, the mappings must be identical.&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;VerificationException&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">503</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Workaround</strong></p>
<p>If index in query is not an index pattern (index name ends with wildcard), check if the index has multiple types. If nothing works during your workaround, please create an issue in our <a class="reference external" href="https://github.com/opensearch-project/sql/issues">GitHub Issues</a> section so that we can provide you with our suggestions and help.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Example</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;workshop participant.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../../_sources/user/dql/troubleshooting.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>