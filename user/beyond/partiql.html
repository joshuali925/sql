<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>PartiQL (JSON) Support &#8212; Example 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=12dfc556" />
    <script src="../../_static/documentation_options.js?v=2709fde1"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="partiql-json-support">
<h1>PartiQL (JSON) Support<a class="headerlink" href="#partiql-json-support" title="Link to this heading">¶</a></h1>
<p class="rubric">Table of contents</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id3">Introduction</a></p></li>
<li><p><a class="reference internal" href="#test-data" id="id4">Test Data</a></p>
<ul>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p></li>
<li><p><a class="reference internal" href="#example-people" id="id6">Example: People</a></p></li>
<li><p><a class="reference internal" href="#example-employees" id="id7">Example: Employees</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#querying-nested-tuple-values" id="id8">Querying Nested Tuple Values</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id9">Description</a></p></li>
<li><p><a class="reference internal" href="#example-1-selecting-top-level" id="id10">Example 1: Selecting Top Level</a></p></li>
<li><p><a class="reference internal" href="#example-2-selecting-deeper-levels" id="id11">Example 2: Selecting Deeper Levels</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#querying-nested-collection" id="id12">Querying Nested Collection</a></p>
<ul>
<li><p><a class="reference internal" href="#id2" id="id13">Description</a></p></li>
<li><p><a class="reference internal" href="#example-1-unnesting-a-nested-collection" id="id14">Example 1: Unnesting a Nested Collection</a></p></li>
<li><p><a class="reference internal" href="#example-2-unnesting-in-existential-subquery" id="id15">Example 2: Unnesting in Existential Subquery</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>In OpenSearch, there are two types of JSON field (called “properties”): <code class="docutils literal notranslate"><span class="pre">object</span></code> and <code class="docutils literal notranslate"><span class="pre">nested</span></code>. An object field can have inner field(s) which could be a simple one or another object field recursively. A nested field is a special version of object type that allows inner field be queried independently.</p>
<p>To support queries for both types, we follow the query language syntax defined in PartiQL specification. PartiQL is a SQL-compatible query language that makes it easy and efficient to query semi-structured and nested data regardless of data format. For now our implementation is only partially compatible with PartiQL specification and more support will be provided in future.</p>
</section>
<section id="test-data">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Test Data</a><a class="headerlink" href="#test-data" title="Link to this heading">¶</a></h2>
<section id="description">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h3>
<p>The test index <code class="docutils literal notranslate"><span class="pre">people</span></code> is to demonstrate our support for queries with deep nested object fields.
The test index <code class="docutils literal notranslate"><span class="pre">employees_nested</span></code> used by all examples in this document is very similar to the one used in official PartiQL documentation.</p>
</section>
<section id="example-people">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Example: People</a><a class="headerlink" href="#example-people" title="Link to this heading">¶</a></h3>
<p>There are three fields in test index <code class="docutils literal notranslate"><span class="pre">people</span></code>: 1) deep nested object field <code class="docutils literal notranslate"><span class="pre">city</span></code>; 2) object field of array value <code class="docutils literal notranslate"><span class="pre">account</span></code>; 3) nested field <code class="docutils literal notranslate"><span class="pre">projects</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;mappings&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;city&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;keyword&quot;</span>
          <span class="p">},</span>
          <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;double&quot;</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="s2">&quot;account&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;keyword&quot;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="s2">&quot;projects&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;nested&quot;</span><span class="p">,</span>
        <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;keyword&quot;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="example-employees">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Example: Employees</a><a class="headerlink" href="#example-employees" title="Link to this heading">¶</a></h3>
<p>Here is the mapping for test index <code class="docutils literal notranslate"><span class="pre">employees_nested</span></code>. Note that field <code class="docutils literal notranslate"><span class="pre">projects</span></code> is a nested field:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;mappings&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;long&quot;</span>
      <span class="p">},</span>
      <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;keyword&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;keyword&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ignore_above&quot;</span><span class="p">:</span> <span class="mi">256</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="s2">&quot;projects&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;nested&quot;</span><span class="p">,</span>
        <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">&quot;keyword&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;keyword&quot;</span>
              <span class="p">}</span>
            <span class="p">},</span>
            <span class="s2">&quot;fielddata&quot;</span><span class="p">:</span> <span class="n">true</span>
          <span class="p">},</span>
          <span class="s2">&quot;started_year&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;long&quot;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;keyword&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;keyword&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ignore_above&quot;</span><span class="p">:</span> <span class="mi">256</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Result set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;employees_nested&quot;</span> <span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
      <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;Bob Smith&quot;</span><span class="p">,</span>
      <span class="s2">&quot;title&quot;</span> <span class="p">:</span> <span class="n">null</span><span class="p">,</span>
      <span class="s2">&quot;projects&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;AWS Redshift Spectrum querying&quot;</span><span class="p">,</span>
          <span class="s2">&quot;started_year&quot;</span> <span class="p">:</span> <span class="mi">1990</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;AWS Redshift security&quot;</span><span class="p">,</span>
          <span class="s2">&quot;started_year&quot;</span> <span class="p">:</span> <span class="mi">1999</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;AWS Aurora security&quot;</span><span class="p">,</span>
          <span class="s2">&quot;started_year&quot;</span> <span class="p">:</span> <span class="mi">2015</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
      <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;Susan Smith&quot;</span><span class="p">,</span>
      <span class="s2">&quot;title&quot;</span> <span class="p">:</span> <span class="s2">&quot;Dev Mgr&quot;</span><span class="p">,</span>
      <span class="s2">&quot;projects&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
      <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;Jane Smith&quot;</span><span class="p">,</span>
      <span class="s2">&quot;title&quot;</span> <span class="p">:</span> <span class="s2">&quot;Software Eng 2&quot;</span><span class="p">,</span>
      <span class="s2">&quot;projects&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;AWS Redshift security&quot;</span><span class="p">,</span>
          <span class="s2">&quot;started_year&quot;</span> <span class="p">:</span> <span class="mi">1998</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;AWS Hello security&quot;</span><span class="p">,</span>
          <span class="s2">&quot;started_year&quot;</span> <span class="p">:</span> <span class="mi">2015</span><span class="p">,</span>
          <span class="s2">&quot;address&quot;</span> <span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="s2">&quot;city&quot;</span> <span class="p">:</span> <span class="s2">&quot;Dallas&quot;</span><span class="p">,</span>
              <span class="s2">&quot;state&quot;</span> <span class="p">:</span> <span class="s2">&quot;TX&quot;</span>
            <span class="p">}</span>
          <span class="p">]</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="querying-nested-tuple-values">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Querying Nested Tuple Values</a><a class="headerlink" href="#querying-nested-tuple-values" title="Link to this heading">¶</a></h2>
<section id="id1">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Description</a><a class="headerlink" href="#id1" title="Link to this heading">¶</a></h3>
<p>Before looking into how nested object field (tuple values) be queried, we need to figure out how many cases are there and how it being handled by our SQL implementation. Therefore, first of all, let’s examine different cases by the query support matrix as follows. This matrix summerizes what has been supported so far for queries with the object and nested fields involved. Note that another complexity is that any field in OpenSearch, regular or property, can have contain more than one values in a single document. This makes object field not always a tuple value which needs to be handled separately.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Level/Field Type</p></th>
<th class="head"><p>Object Fields</p></th>
<th class="head"><p>Object Fields (array)</p></th>
<th class="head"><p>Nested Fields</p></th>
<th class="head"><p>Comment</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Selecting top level</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>The original JSON of
field value is returned
which is either a JSON
object or JSON array.</p></td>
</tr>
<tr class="row-odd"><td><p>Selecting second level</p></td>
<td><p>Yes</p></td>
<td><p>No
(exception may)
be thrown)</p></td>
<td><p>Yes
(or null returned if not in PartiQL syntax)</p></td>
<td rowspan="2"><p>PartiQL specification
is followed</p></td>
</tr>
<tr class="row-even"><td><p>Selecting deeper levels</p></td>
<td><p>Yes</p></td>
<td><p>No
(exception may
be thrown)</p></td>
<td><p>No
(exception may
be thrown)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="example-1-selecting-top-level">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Example 1: Selecting Top Level</a><a class="headerlink" href="#example-1-selecting-top-level" title="Link to this heading">¶</a></h3>
<p>Selecting top level for object fields, object fields of array value and nested fields returns original JSON object or array of the field. For example, object field <code class="docutils literal notranslate"><span class="pre">city</span></code> is a JSON object, object field (of array value) <code class="docutils literal notranslate"><span class="pre">accounts</span></code> and nested field <code class="docutils literal notranslate"><span class="pre">projects</span></code> are JSON arrays:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="n">city</span><span class="p">,</span> <span class="n">accounts</span><span class="p">,</span> <span class="n">projects</span> <span class="n">FROM</span> <span class="n">people</span><span class="p">;</span>
<span class="n">fetched</span> <span class="n">rows</span> <span class="o">/</span> <span class="n">total</span> <span class="n">rows</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>
<span class="o">+-----------------------------------------------------+------------+----------------------------------------------------------------------------------------------------------------+</span>
<span class="o">|</span> <span class="n">city</span>                                                <span class="o">|</span> <span class="n">accounts</span>   <span class="o">|</span> <span class="n">projects</span>                                                                                                       <span class="o">|</span>
<span class="o">|-----------------------------------------------------+------------+----------------------------------------------------------------------------------------------------------------|</span>
<span class="o">|</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Seattle&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="mf">10.5</span><span class="p">}}</span> <span class="o">|</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>  <span class="o">|</span> <span class="p">[{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;AWS Redshift Spectrum querying&#39;</span><span class="p">},{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;AWS Redshift security&#39;</span><span class="p">},{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;AWS Aurora security&#39;</span><span class="p">}]</span> <span class="o">|</span>
<span class="o">+-----------------------------------------------------+------------+----------------------------------------------------------------------------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="example-2-selecting-deeper-levels">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Example 2: Selecting Deeper Levels</a><a class="headerlink" href="#example-2-selecting-deeper-levels" title="Link to this heading">¶</a></h3>
<p>Selecting at deeper levels for object fields of regular value returns inner field value. For example, <code class="docutils literal notranslate"><span class="pre">city.location</span></code> is an inner object field and <code class="docutils literal notranslate"><span class="pre">city.location.altitude</span></code> is a regular double field:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="n">city</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="n">city</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">latitude</span> <span class="n">FROM</span> <span class="n">people</span><span class="p">;</span>
<span class="n">fetched</span> <span class="n">rows</span> <span class="o">/</span> <span class="n">total</span> <span class="n">rows</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>
<span class="o">+--------------------+--------------------------+</span>
<span class="o">|</span> <span class="n">city</span><span class="o">.</span><span class="n">location</span>      <span class="o">|</span> <span class="n">city</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">latitude</span>   <span class="o">|</span>
<span class="o">|--------------------+--------------------------|</span>
<span class="o">|</span> <span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="mf">10.5</span><span class="p">}</span> <span class="o">|</span> <span class="mf">10.5</span>                     <span class="o">|</span>
<span class="o">+--------------------+--------------------------+</span>
</pre></div>
</div>
<p>For selecting second level for nested fields, please read on and find more details in the following sections.</p>
</section>
</section>
<section id="querying-nested-collection">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">Querying Nested Collection</a><a class="headerlink" href="#querying-nested-collection" title="Link to this heading">¶</a></h2>
<section id="id2">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Description</a><a class="headerlink" href="#id2" title="Link to this heading">¶</a></h3>
<p>In SQL-92, a database table can only have tuples that consists of scalar values. PartiQL extends SQL-92 to allow you query and unnest nested collection conveniently. In OpenSearch world, this is very useful for index with object or nested field.</p>
</section>
<section id="example-1-unnesting-a-nested-collection">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Example 1: Unnesting a Nested Collection</a><a class="headerlink" href="#example-1-unnesting-a-nested-collection" title="Link to this heading">¶</a></h3>
<p>In the following example, it finds nested document (project) with field value (name) that satisfies the predicate (contains ‘security’). Note that because each parent document can have more than one nested documents, the matched nested document is flattened. In other word, the final result is the Cartesian Product between parent and nested documents.</p>
<p>SQL query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">_plugins</span><span class="o">/</span><span class="n">_sql</span>
<span class="p">{</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT e.name AS employeeName,</span>
<span class="s2">               p.name AS projectName</span>
<span class="s2">        FROM employees_nested AS e,</span>
<span class="s2">             e.projects AS p</span>
<span class="s2">        WHERE p.name LIKE &#39;</span><span class="si">%s</span><span class="s2">ecurity%&#39;</span>
<span class="s2">        &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Explain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;from&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;bool&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;filter&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;bool&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;must&quot;</span> <span class="p">:</span> <span class="p">[</span>
              <span class="p">{</span>
                <span class="s2">&quot;nested&quot;</span> <span class="p">:</span> <span class="p">{</span>
                  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;wildcard&quot;</span> <span class="p">:</span> <span class="p">{</span>
                      <span class="s2">&quot;projects.name&quot;</span> <span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;wildcard&quot;</span> <span class="p">:</span> <span class="s2">&quot;*security*&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;boost&quot;</span> <span class="p">:</span> <span class="mf">1.0</span>
                      <span class="p">}</span>
                    <span class="p">}</span>
                  <span class="p">},</span>
                  <span class="s2">&quot;path&quot;</span> <span class="p">:</span> <span class="s2">&quot;projects&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;ignore_unmapped&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
                  <span class="s2">&quot;score_mode&quot;</span> <span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;boost&quot;</span> <span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                  <span class="s2">&quot;inner_hits&quot;</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;ignore_unmapped&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
                    <span class="s2">&quot;from&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                    <span class="s2">&quot;version&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
                    <span class="s2">&quot;seq_no_primary_term&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
                    <span class="s2">&quot;explain&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
                    <span class="s2">&quot;track_scores&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
                    <span class="s2">&quot;_source&quot;</span> <span class="p">:</span> <span class="p">{</span>
                      <span class="s2">&quot;includes&quot;</span> <span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;projects.name&quot;</span>
                      <span class="p">],</span>
                      <span class="s2">&quot;excludes&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
                    <span class="p">}</span>
                  <span class="p">}</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;adjust_pure_negative&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
            <span class="s2">&quot;boost&quot;</span> <span class="p">:</span> <span class="mf">1.0</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="s2">&quot;adjust_pure_negative&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;boost&quot;</span> <span class="p">:</span> <span class="mf">1.0</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">&quot;_source&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;includes&quot;</span> <span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;name&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;excludes&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Result set:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>employeeName</p></th>
<th class="head"><p>projectName</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Bob Smith</p></td>
<td><p>AWS Aurora security</p></td>
</tr>
<tr class="row-odd"><td><p>Bob Smith</p></td>
<td><p>AWS Redshift security</p></td>
</tr>
<tr class="row-even"><td><p>Jane Smith</p></td>
<td><p>AWS Hello security</p></td>
</tr>
<tr class="row-odd"><td><p>Jane Smith</p></td>
<td><p>AWS Redshift security</p></td>
</tr>
</tbody>
</table>
</section>
<section id="example-2-unnesting-in-existential-subquery">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">Example 2: Unnesting in Existential Subquery</a><a class="headerlink" href="#example-2-unnesting-in-existential-subquery" title="Link to this heading">¶</a></h3>
<p>Alternatively, a nested collection can be unnested in subquery to check if it satisfies a condition.</p>
<p>SQL query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">_plugins</span><span class="o">/</span><span class="n">_sql</span>
<span class="p">{</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT e.name AS employeeName</span>
<span class="s2">        FROM employees_nested AS e</span>
<span class="s2">        WHERE EXISTS (</span>
<span class="s2">          SELECT *</span>
<span class="s2">          FROM e.projects AS p</span>
<span class="s2">          WHERE p.name LIKE &#39;</span><span class="si">%s</span><span class="s2">ecurity%&#39;</span>
<span class="s2">        )</span>
<span class="s2">        &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Explain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;from&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;bool&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;filter&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;bool&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;must&quot;</span> <span class="p">:</span> <span class="p">[</span>
              <span class="p">{</span>
                <span class="s2">&quot;nested&quot;</span> <span class="p">:</span> <span class="p">{</span>
                  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;bool&quot;</span> <span class="p">:</span> <span class="p">{</span>
                      <span class="s2">&quot;must&quot;</span> <span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                          <span class="s2">&quot;bool&quot;</span> <span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;must&quot;</span> <span class="p">:</span> <span class="p">[</span>
                              <span class="p">{</span>
                                <span class="s2">&quot;bool&quot;</span> <span class="p">:</span> <span class="p">{</span>
                                  <span class="s2">&quot;must_not&quot;</span> <span class="p">:</span> <span class="p">[</span>
                                    <span class="p">{</span>
                                      <span class="s2">&quot;bool&quot;</span> <span class="p">:</span> <span class="p">{</span>
                                        <span class="s2">&quot;must_not&quot;</span> <span class="p">:</span> <span class="p">[</span>
                                          <span class="p">{</span>
                                            <span class="s2">&quot;exists&quot;</span> <span class="p">:</span> <span class="p">{</span>
                                              <span class="s2">&quot;field&quot;</span> <span class="p">:</span> <span class="s2">&quot;projects&quot;</span><span class="p">,</span>
                                              <span class="s2">&quot;boost&quot;</span> <span class="p">:</span> <span class="mf">1.0</span>
                                            <span class="p">}</span>
                                          <span class="p">}</span>
                                        <span class="p">],</span>
                                        <span class="s2">&quot;adjust_pure_negative&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
                                        <span class="s2">&quot;boost&quot;</span> <span class="p">:</span> <span class="mf">1.0</span>
                                      <span class="p">}</span>
                                    <span class="p">}</span>
                                  <span class="p">],</span>
                                  <span class="s2">&quot;adjust_pure_negative&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
                                  <span class="s2">&quot;boost&quot;</span> <span class="p">:</span> <span class="mf">1.0</span>
                                <span class="p">}</span>
                              <span class="p">},</span>
                              <span class="p">{</span>
                                <span class="s2">&quot;wildcard&quot;</span> <span class="p">:</span> <span class="p">{</span>
                                  <span class="s2">&quot;projects.name&quot;</span> <span class="p">:</span> <span class="p">{</span>
                                    <span class="s2">&quot;wildcard&quot;</span> <span class="p">:</span> <span class="s2">&quot;*security*&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;boost&quot;</span> <span class="p">:</span> <span class="mf">1.0</span>
                                  <span class="p">}</span>
                                <span class="p">}</span>
                              <span class="p">}</span>
                            <span class="p">],</span>
                            <span class="s2">&quot;adjust_pure_negative&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
                            <span class="s2">&quot;boost&quot;</span> <span class="p">:</span> <span class="mf">1.0</span>
                          <span class="p">}</span>
                        <span class="p">}</span>
                      <span class="p">],</span>
                      <span class="s2">&quot;adjust_pure_negative&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
                      <span class="s2">&quot;boost&quot;</span> <span class="p">:</span> <span class="mf">1.0</span>
                    <span class="p">}</span>
                  <span class="p">},</span>
                  <span class="s2">&quot;path&quot;</span> <span class="p">:</span> <span class="s2">&quot;projects&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;ignore_unmapped&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
                  <span class="s2">&quot;score_mode&quot;</span> <span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;boost&quot;</span> <span class="p">:</span> <span class="mf">1.0</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;adjust_pure_negative&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
            <span class="s2">&quot;boost&quot;</span> <span class="p">:</span> <span class="mf">1.0</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="s2">&quot;adjust_pure_negative&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;boost&quot;</span> <span class="p">:</span> <span class="mf">1.0</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">&quot;_source&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;includes&quot;</span> <span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;name&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;excludes&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Result set:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>employeeName</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Bob Smith</p></td>
</tr>
<tr class="row-odd"><td><p>Jane Smith</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Example</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;workshop participant.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../../_sources/user/beyond/partiql.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>