<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Cross-Cluster Search &#8212; sql-docs  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/alabaster.css?v=12dfc556" />
    <script src="../../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="cross-cluster-search">
<h1>Cross-Cluster Search<a class="headerlink" href="#cross-cluster-search" title="Link to this heading">¶</a></h1>
<p class="rubric">Table of contents</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id1">Introduction</a></p></li>
<li><p><a class="reference internal" href="#configuration" id="id2">Configuration</a></p></li>
<li><p><a class="reference internal" href="#using-cross-cluster-search-in-ppl" id="id3">Using Cross-Cluster Search in PPL</a></p></li>
<li><p><a class="reference internal" href="#limitation" id="id4">Limitation</a></p></li>
<li><p><a class="reference internal" href="#authentication-and-permission" id="id5">Authentication and Permission</a></p></li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>Cross-cluster search lets any node in a cluster execute search requests against other clusters.
It makes searching easy across all connected clusters, allowing users to use multiple smaller clusters instead of a single large one.</p>
</section>
<section id="configuration">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Configuration</a><a class="headerlink" href="#configuration" title="Link to this heading">¶</a></h2>
<p>On the local cluster, add the remote cluster name and the IP address with port 9300 for each seed node.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>PUT<span class="w"> </span>_cluster/settings
<span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;persistent&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;cluster.remote&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;&lt;remote-cluster-name&gt;&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="s2">&quot;seeds&quot;</span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;&lt;remote-cluster-IP-address&gt;:9300&quot;</span><span class="o">]</span>
<span class="w">      </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">  </span><span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</section>
<section id="using-cross-cluster-search-in-ppl">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Using Cross-Cluster Search in PPL</a><a class="headerlink" href="#using-cross-cluster-search-in-ppl" title="Link to this heading">¶</a></h2>
<p>Perform cross-cluster search by using “&lt;cluster-name&gt;:&lt;index-name&gt;” as the index identifier.</p>
<p>Example PPL query:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>os&gt;<span class="w"> </span><span class="nv">source</span><span class="o">=</span>my_remote_cluster:accounts<span class="p">;</span>
fetched<span class="w"> </span>rows<span class="w"> </span>/<span class="w"> </span>total<span class="w"> </span><span class="nv">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span>/4
+------------------+-------------+----------------------+-----------+----------+--------+------------+---------+-------+-----------------------+------------+
<span class="p">|</span><span class="w"> </span>account_number<span class="w">   </span><span class="p">|</span><span class="w"> </span>firstname<span class="w">   </span><span class="p">|</span><span class="w"> </span>address<span class="w">              </span><span class="p">|</span><span class="w"> </span>balance<span class="w">   </span><span class="p">|</span><span class="w"> </span>gender<span class="w">   </span><span class="p">|</span><span class="w"> </span>city<span class="w">   </span><span class="p">|</span><span class="w"> </span>employer<span class="w">   </span><span class="p">|</span><span class="w"> </span>state<span class="w">   </span><span class="p">|</span><span class="w"> </span>age<span class="w">   </span><span class="p">|</span><span class="w"> </span>email<span class="w">                 </span><span class="p">|</span><span class="w"> </span>lastname<span class="w">   </span><span class="p">|</span>
<span class="p">|</span>------------------+-------------+----------------------+-----------+----------+--------+------------+---------+-------+-----------------------+------------<span class="p">|</span>
<span class="p">|</span><span class="w"> </span><span class="m">1</span><span class="w">                </span><span class="p">|</span><span class="w"> </span>Amber<span class="w">       </span><span class="p">|</span><span class="w"> </span><span class="m">880</span><span class="w"> </span>Holmes<span class="w"> </span>Lane<span class="w">      </span><span class="p">|</span><span class="w"> </span><span class="m">39225</span><span class="w">     </span><span class="p">|</span><span class="w"> </span>M<span class="w">        </span><span class="p">|</span><span class="w"> </span>Brogan<span class="w"> </span><span class="p">|</span><span class="w"> </span>Pyrami<span class="w">     </span><span class="p">|</span><span class="w"> </span>IL<span class="w">      </span><span class="p">|</span><span class="w"> </span><span class="m">32</span><span class="w">    </span><span class="p">|</span><span class="w"> </span>amberduke@pyrami.com<span class="w">  </span><span class="p">|</span><span class="w"> </span>Duke<span class="w">       </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span><span class="m">6</span><span class="w">                </span><span class="p">|</span><span class="w"> </span>Hattie<span class="w">      </span><span class="p">|</span><span class="w"> </span><span class="m">671</span><span class="w"> </span>Bristol<span class="w"> </span>Street<span class="w">   </span><span class="p">|</span><span class="w"> </span><span class="m">5686</span><span class="w">      </span><span class="p">|</span><span class="w"> </span>M<span class="w">        </span><span class="p">|</span><span class="w"> </span>Dante<span class="w">  </span><span class="p">|</span><span class="w"> </span>Netagy<span class="w">     </span><span class="p">|</span><span class="w"> </span>TN<span class="w">      </span><span class="p">|</span><span class="w"> </span><span class="m">36</span><span class="w">    </span><span class="p">|</span><span class="w"> </span>hattiebond@netagy.com<span class="w"> </span><span class="p">|</span><span class="w"> </span>Bond<span class="w">       </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span><span class="m">13</span><span class="w">               </span><span class="p">|</span><span class="w"> </span>Nanette<span class="w">     </span><span class="p">|</span><span class="w"> </span><span class="m">789</span><span class="w"> </span>Madison<span class="w"> </span>Street<span class="w">   </span><span class="p">|</span><span class="w"> </span><span class="m">32838</span><span class="w">     </span><span class="p">|</span><span class="w"> </span>F<span class="w">        </span><span class="p">|</span><span class="w"> </span>Nogal<span class="w">  </span><span class="p">|</span><span class="w"> </span>Quility<span class="w">    </span><span class="p">|</span><span class="w"> </span>VA<span class="w">      </span><span class="p">|</span><span class="w"> </span><span class="m">28</span><span class="w">    </span><span class="p">|</span><span class="w"> </span>null<span class="w">                  </span><span class="p">|</span><span class="w"> </span>Bates<span class="w">      </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span><span class="m">18</span><span class="w">               </span><span class="p">|</span><span class="w"> </span>Dale<span class="w">        </span><span class="p">|</span><span class="w"> </span><span class="m">467</span><span class="w"> </span>Hutchinson<span class="w"> </span>Court<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">4180</span><span class="w">      </span><span class="p">|</span><span class="w"> </span>M<span class="w">        </span><span class="p">|</span><span class="w"> </span>Orick<span class="w">  </span><span class="p">|</span><span class="w"> </span>null<span class="w">       </span><span class="p">|</span><span class="w"> </span>MD<span class="w">      </span><span class="p">|</span><span class="w"> </span><span class="m">33</span><span class="w">    </span><span class="p">|</span><span class="w"> </span>daleadams@boink.com<span class="w">   </span><span class="p">|</span><span class="w"> </span>Adams<span class="w">      </span><span class="p">|</span>
+------------------+-------------+----------------------+-----------+----------+--------+------------+---------+-------+-----------------------+------------+
</pre></div>
</div>
</section>
<section id="limitation">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Limitation</a><a class="headerlink" href="#limitation" title="Link to this heading">¶</a></h2>
<p>Since OpenSearch does not support cross cluster index metadata retrieval, field mapping of a remote cluster index is not available to the local cluster.
(<a class="reference external" href="https://github.com/opensearch-project/OpenSearch/issues/6573">[Feature] Cross cluster field mappings query #6573</a>)
Therefore, the query engine requires that for any remote cluster index that the users need to search,
the local cluster keep a field mapping system index with the same index name.
This can be done by creating an index on the local cluster with the same name and schema as the remote cluster index.</p>
</section>
<section id="authentication-and-permission">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Authentication and Permission</a><a class="headerlink" href="#authentication-and-permission" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>The security plugin authenticates the user on the local cluster.</p></li>
<li><p>The security plugin fetches the user’s backend roles on the local cluster.</p></li>
<li><p>The call, including the authenticated user, is forwarded to the remote cluster.</p></li>
<li><p>The user’s permissions are evaluated on the remote cluster.</p></li>
</ol>
<p>Check <a class="reference external" href="https://opensearch.org/docs/latest/security/access-control/cross-cluster-search/">Cross-cluster search access control</a> for more details.</p>
<p>Example: Create the ppl_role for test_user on local cluster and the ccs_role for test_user on remote cluster. Then test_user could use PPL to query <code class="docutils literal notranslate"><span class="pre">ppl-security-demo</span></code> index on remote cluster.</p>
<ol class="arabic">
<li><p>On the local cluster, refer to <a class="reference external" href="security.rst">Security Settings</a> to create role and user for PPL plugin and index access permission.</p></li>
<li><p>On the remote cluster, create a new role and grant permission to access index. Create a user with the same name and credentials as the local cluster, and map the user to this role:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>PUT<span class="w"> </span>_plugins/_security/api/roles/ccs_role
<span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;index_permissions&quot;</span>:<span class="o">[</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;index_patterns&quot;</span>:<span class="o">[</span><span class="s2">&quot;ppl-security-demo&quot;</span><span class="o">]</span>,
<span class="w">      </span><span class="s2">&quot;allowed_actions&quot;</span>:<span class="o">[</span>
<span class="w">        </span><span class="s2">&quot;indices:admin/shards/search_shards&quot;</span>,
<span class="w">        </span><span class="s2">&quot;indices:data/read/search&quot;</span>
<span class="w">      </span><span class="o">]</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">  </span><span class="o">]</span>
<span class="o">}</span>

PUT<span class="w"> </span>_plugins/_security/api/rolesmapping/ccs_role
<span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;backend_roles&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="o">[]</span>,
<span class="w">  </span><span class="s2">&quot;hosts&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="o">[]</span>,
<span class="w">  </span><span class="s2">&quot;users&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;test_user&quot;</span><span class="o">]</span>
<span class="o">}</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../index.html">sql-docs</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, josh.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../../../../_sources/docs/user/ppl/admin/cross_cluster_search.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>