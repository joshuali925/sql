<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Basic Queries &#8212; sql-docs  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=12dfc556" />
    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="basic-queries">
<h1>Basic Queries<a class="headerlink" href="#basic-queries" title="Link to this heading">¶</a></h1>
<p class="rubric">Table of contents</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id11">Introduction</a></p>
<ul>
<li><p><a class="reference internal" href="#syntax" id="id12">Syntax</a></p></li>
<li><p><a class="reference internal" href="#fundamentals" id="id13">Fundamentals</a></p></li>
<li><p><a class="reference internal" href="#execution-order" id="id14">Execution Order</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#select" id="id15">SELECT</a></p>
<ul>
<li><p><a class="reference internal" href="#description" id="id16">Description</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id17">Syntax</a></p></li>
<li><p><a class="reference internal" href="#example-1-selecting-all-fields" id="id18">Example 1: Selecting All Fields</a></p></li>
<li><p><a class="reference internal" href="#example-2-selecting-specific-fields" id="id19">Example 2: Selecting Specific Fields</a></p></li>
<li><p><a class="reference internal" href="#example-3-using-field-alias" id="id20">Example 3: Using Field Alias</a></p></li>
<li><p><a class="reference internal" href="#example-4-selecting-distinct-fields" id="id21">Example 4: Selecting Distinct Fields</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#from" id="id22">FROM</a></p>
<ul>
<li><p><a class="reference internal" href="#id4" id="id23">Description</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id24">Syntax</a></p></li>
<li><p><a class="reference internal" href="#example-1-using-index-alias" id="id25">Example 1: Using Index Alias</a></p></li>
<li><p><a class="reference internal" href="#example-2-selecting-from-multiple-indices-by-index-pattern" id="id26">Example 2: Selecting From Multiple Indices by Index Pattern</a></p></li>
<li><p><a class="reference internal" href="#example-3-deprecating-selecting-from-specific-index-type" id="id27">Example 3: [Deprecating] Selecting From Specific Index Type</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#where" id="id28">WHERE</a></p>
<ul>
<li><p><a class="reference internal" href="#id6" id="id29">Description</a></p></li>
<li><p><a class="reference internal" href="#example-1-comparison-operators" id="id30">Example 1: Comparison Operators</a></p></li>
<li><p><a class="reference internal" href="#example-2-missing-fields" id="id31">Example 2: Missing Fields</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#group-by" id="id32">GROUP BY</a></p>
<ul>
<li><p><a class="reference internal" href="#id7" id="id33">Description</a></p></li>
<li><p><a class="reference internal" href="#example-1-grouping-by-fields" id="id34">Example 1: Grouping by Fields</a></p></li>
<li><p><a class="reference internal" href="#example-2-grouping-by-field-alias" id="id35">Example 2: Grouping by Field Alias</a></p></li>
<li><p><a class="reference internal" href="#example-3-grouping-by-ordinal" id="id36">Example 3: Grouping by Ordinal</a></p></li>
<li><p><a class="reference internal" href="#example-4-grouping-by-scalar-function" id="id37">Example 4: Grouping by Scalar Function</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#having" id="id38">HAVING</a></p>
<ul>
<li><p><a class="reference internal" href="#id8" id="id39">Description</a></p></li>
<li><p><a class="reference internal" href="#example" id="id40">Example</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#order-by" id="id41">ORDER BY</a></p>
<ul>
<li><p><a class="reference internal" href="#id9" id="id42">Description</a></p></li>
<li><p><a class="reference internal" href="#example-1-ordering-by-fields" id="id43">Example 1: Ordering by Fields</a></p></li>
<li><p><a class="reference internal" href="#example-2-specifying-order-for-null" id="id44">Example 2: Specifying Order for Null</a></p></li>
<li><p><a class="reference internal" href="#example-3-ordering-by-aggregate-functions" id="id45">Example 3: Ordering by Aggregate Functions</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#limit" id="id46">LIMIT</a></p>
<ul>
<li><p><a class="reference internal" href="#id10" id="id47">Description</a></p></li>
<li><p><a class="reference internal" href="#example-1-limiting-result-size" id="id48">Example 1: Limiting Result Size</a></p></li>
<li><p><a class="reference internal" href="#example-2-fetching-at-offset" id="id49">Example 2: Fetching at Offset</a></p></li>
<li><p><a class="reference internal" href="#limitation" id="id50">Limitation</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">SELECT</span></code> statement in SQL is the most common query that retrieves data from OpenSearch index. In this doc, only simple <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> statement with single index and query involved is covered. A <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> statement includes <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>, <code class="docutils literal notranslate"><span class="pre">FROM</span></code>, <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>, <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>, <code class="docutils literal notranslate"><span class="pre">HAVING</span></code>, <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> and <code class="docutils literal notranslate"><span class="pre">LIMIT</span></code> clause. Among these clauses, <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> and <code class="docutils literal notranslate"><span class="pre">FROM</span></code> are the foundation to specify which fields to be fetched and which index they should be fetched from. All others are optional and used according to your needs. Please read on for their description, syntax and use cases in details.</p>
<section id="syntax">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Syntax</a><a class="headerlink" href="#syntax" title="Link to this heading">¶</a></h3>
<p>The syntax of <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> statement is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="p">[</span><span class="n">ALL</span> <span class="o">|</span> <span class="n">DISTINCT</span><span class="p">]</span> <span class="p">(</span><span class="o">*</span> <span class="o">|</span> <span class="n">expression</span><span class="p">)</span> <span class="p">[[</span><span class="n">AS</span><span class="p">]</span> <span class="n">alias</span><span class="p">]</span> <span class="p">[,</span> <span class="o">...</span><span class="p">]</span>
<span class="n">FROM</span> <span class="n">index_name</span>
<span class="p">[</span><span class="n">WHERE</span> <span class="n">predicates</span><span class="p">]</span>
<span class="p">[</span><span class="n">GROUP</span> <span class="n">BY</span> <span class="n">expression</span> <span class="p">[,</span> <span class="o">...</span><span class="p">]</span>
 <span class="p">[</span><span class="n">HAVING</span> <span class="n">predicates</span><span class="p">]]</span>
<span class="p">[</span><span class="n">ORDER</span> <span class="n">BY</span> <span class="n">expression</span> <span class="p">[</span><span class="n">ASC</span> <span class="o">|</span> <span class="n">DESC</span><span class="p">]</span> <span class="p">[</span><span class="n">NULLS</span> <span class="p">{</span><span class="n">FIRST</span> <span class="o">|</span> <span class="n">LAST</span><span class="p">}]</span> <span class="p">[,</span> <span class="o">...</span><span class="p">]]</span>
<span class="p">[</span><span class="n">LIMIT</span> <span class="p">[</span><span class="n">offset</span><span class="p">,</span> <span class="p">]</span> <span class="n">size</span><span class="p">]</span>
</pre></div>
</div>
<p>Although multiple query statements to execute in batch is not supported, ending with semicolon <code class="docutils literal notranslate"><span class="pre">;</span></code> is still allowed. For example, you can run <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span> <span class="pre">FROM</span> <span class="pre">accounts;</span></code> without issue. This is useful to support queries generated by other tool, such as Microsoft Excel or BI tool.</p>
</section>
<section id="fundamentals">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Fundamentals</a><a class="headerlink" href="#fundamentals" title="Link to this heading">¶</a></h3>
<p>Apart from predefined keyword of SQL language, the most basic element is literal and identifier. Literal is numeric, string, date or boolean constant. Identifier represents OpenSearch index or field name. With arithmetic operators and SQL functions applied, the basic literals and identifiers can be built into complex expression.</p>
<p>Rule <code class="docutils literal notranslate"><span class="pre">expressionAtom</span></code>:</p>
<img alt="../../../_images/expressionAtom.png" src="../../../_images/expressionAtom.png" />
<p>The expression in turn can be combined into predicate with logical operator. Typically, predicate is used in <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> and <code class="docutils literal notranslate"><span class="pre">HAVING</span></code> clause to filter out data by conditions specified.</p>
<p>Rule <code class="docutils literal notranslate"><span class="pre">expression</span></code>:</p>
<img alt="../../../_images/expression.png" src="../../../_images/expression.png" />
<p>Rule <code class="docutils literal notranslate"><span class="pre">predicate</span></code>:</p>
<img alt="../../../_images/predicate.png" src="../../../_images/predicate.png" />
</section>
<section id="execution-order">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Execution Order</a><a class="headerlink" href="#execution-order" title="Link to this heading">¶</a></h3>
<p>The actual order of execution is very different from its appearance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FROM</span> <span class="n">index</span>
 <span class="n">WHERE</span> <span class="n">predicates</span>
  <span class="n">GROUP</span> <span class="n">BY</span> <span class="n">expressions</span>
   <span class="n">HAVING</span> <span class="n">predicates</span>
    <span class="n">SELECT</span> <span class="n">expressions</span>
     <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">expressions</span>
      <span class="n">LIMIT</span> <span class="n">size</span>
</pre></div>
</div>
</section>
</section>
<section id="select">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">SELECT</a><a class="headerlink" href="#select" title="Link to this heading">¶</a></h2>
<section id="description">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">SELECT</span></code> clause specifies which fields in OpenSearch index should be retrieved.</p>
</section>
<section id="id1">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Syntax</a><a class="headerlink" href="#id1" title="Link to this heading">¶</a></h3>
<p>Rule <code class="docutils literal notranslate"><span class="pre">selectElements</span></code>:</p>
<img alt="../../../_images/selectElements.png" src="../../../_images/selectElements.png" />
<p>Rule <code class="docutils literal notranslate"><span class="pre">selectElement</span></code>:</p>
<img alt="../../../_images/selectElement.png" src="../../../_images/selectElement.png" />
</section>
<section id="example-1-selecting-all-fields">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">Example 1: Selecting All Fields</a><a class="headerlink" href="#example-1-selecting-all-fields" title="Link to this heading">¶</a></h3>
<p>You can use <code class="docutils literal notranslate"><span class="pre">*</span></code> to fetch all fields in the index which is very convenient when you just want to have a quick look at your data.</p>
<p>SQL query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">_plugins</span><span class="o">/</span><span class="n">_sql</span>
<span class="p">{</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="s2">&quot;SELECT * FROM accounts&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Explain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;from&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">200</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Result set:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>account_number</p></th>
<th class="head"><p>firstname</p></th>
<th class="head"><p>gender</p></th>
<th class="head"><p>city</p></th>
<th class="head"><p>balance</p></th>
<th class="head"><p>employer</p></th>
<th class="head"><p>state</p></th>
<th class="head"><p>email</p></th>
<th class="head"><p>address</p></th>
<th class="head"><p>lastname</p></th>
<th class="head"><p>age</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Amber</p></td>
<td><p>M</p></td>
<td><p>Brogan</p></td>
<td><p>39225</p></td>
<td><p>Pyrami</p></td>
<td><p>IL</p></td>
<td><p><a class="reference external" href="mailto:amberduke&#37;&#52;&#48;pyrami&#46;com">amberduke<span>&#64;</span>pyrami<span>&#46;</span>com</a></p></td>
<td><p>880 Holmes Lane</p></td>
<td><p>Duke</p></td>
<td><p>32</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>Hattie</p></td>
<td><p>M</p></td>
<td><p>Dante</p></td>
<td><p>5686</p></td>
<td><p>Netagy</p></td>
<td><p>TN</p></td>
<td><p><a class="reference external" href="mailto:hattiebond&#37;&#52;&#48;netagy&#46;com">hattiebond<span>&#64;</span>netagy<span>&#46;</span>com</a></p></td>
<td><p>671 Bristol Street</p></td>
<td><p>Bond</p></td>
<td><p>36</p></td>
</tr>
<tr class="row-even"><td><p>13</p></td>
<td><p>Nanette</p></td>
<td><p>F</p></td>
<td><p>Nogal</p></td>
<td><p>32838</p></td>
<td><p>Quility</p></td>
<td><p>VA</p></td>
<td><p><a class="reference external" href="mailto:nanettebates&#37;&#52;&#48;quility&#46;com">nanettebates<span>&#64;</span>quility<span>&#46;</span>com</a></p></td>
<td><p>789 Madison Street</p></td>
<td><p>Bates</p></td>
<td><p>28</p></td>
</tr>
<tr class="row-odd"><td><p>18</p></td>
<td><p>Dale</p></td>
<td><p>M</p></td>
<td><p>Orick</p></td>
<td><p>4180</p></td>
<td><p>null</p></td>
<td><p>MD</p></td>
<td><p><a class="reference external" href="mailto:daleadams&#37;&#52;&#48;boink&#46;com">daleadams<span>&#64;</span>boink<span>&#46;</span>com</a></p></td>
<td><p>467 Hutchinson Court</p></td>
<td><p>Adams</p></td>
<td><p>33</p></td>
</tr>
</tbody>
</table>
</section>
<section id="example-2-selecting-specific-fields">
<h3><a class="toc-backref" href="#id19" role="doc-backlink">Example 2: Selecting Specific Fields</a><a class="headerlink" href="#example-2-selecting-specific-fields" title="Link to this heading">¶</a></h3>
<p>More often you would give specific field name(s) in <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> clause to avoid large and unnecessary data retrieved.</p>
<p>SQL query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">_plugins</span><span class="o">/</span><span class="n">_sql</span>
<span class="p">{</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="s2">&quot;SELECT firstname, lastname FROM accounts&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Explain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;from&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
  <span class="s2">&quot;_source&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;includes&quot;</span> <span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;firstname&quot;</span><span class="p">,</span>
      <span class="s2">&quot;lastname&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;excludes&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Result set:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>firstname</p></th>
<th class="head"><p>lastname</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Amber</p></td>
<td><p>Duke</p></td>
</tr>
<tr class="row-odd"><td><p>Dale</p></td>
<td><p>Adams</p></td>
</tr>
<tr class="row-even"><td><p>Hattie</p></td>
<td><p>Bond</p></td>
</tr>
<tr class="row-odd"><td><p>Nanette</p></td>
<td><p>Bates</p></td>
</tr>
</tbody>
</table>
<p>One can also provide meta-field name(s) to retrieve reserved-fields (beginning with underscore) from OpenSearch documents.  They may also be used
in the query <cite>WHERE</cite> or <cite>ORDER BY</cite> clauses. Meta-fields are not output from wildcard calls (<cite>SELECT *</cite>) and must be explicitly included to be returned.</p>
<p>Note: <cite>_routing</cite> is used differently in the <cite>SELECT</cite> and <cite>WHERE</cite> clauses.  In <cite>WHERE</cite>, it contains the routing hash id. In <cite>SELECT</cite>,
it returns the shard used for the query (unless shards aren’t active, in which case it returns the routing hash id).</p>
<p>SQL query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">_plugins</span><span class="o">/</span><span class="n">_sql</span>
<span class="p">{</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="s2">&quot;SELECT firstname, lastname, _id, _index, _sort, _routing FROM accounts WHERE _index = &#39;accounts&#39;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Explain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;from&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
  <span class="s2">&quot;_source&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;includes&quot;</span> <span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;firstname&quot;</span><span class="p">,</span>
      <span class="s2">&quot;_id&quot;</span><span class="p">,</span>
      <span class="s2">&quot;_index&quot;</span><span class="p">,</span>
      <span class="s2">&quot;_routing&quot;</span><span class="p">,</span>
      <span class="s2">&quot;_sort&quot;</span><span class="p">,</span>
      <span class="s2">&quot;lastname&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;excludes&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This produces results like this for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="n">firstname</span><span class="p">,</span> <span class="n">lastname</span><span class="p">,</span> <span class="n">_index</span><span class="p">,</span> <span class="n">_sort</span> <span class="n">FROM</span> <span class="n">accounts</span><span class="p">;</span>
<span class="n">fetched</span> <span class="n">rows</span> <span class="o">/</span> <span class="n">total</span> <span class="n">rows</span> <span class="o">=</span> <span class="mi">4</span><span class="o">/</span><span class="mi">4</span>
<span class="o">+-------------+------------+----------+---------+</span>
<span class="o">|</span> <span class="n">firstname</span>   <span class="o">|</span> <span class="n">lastname</span>   <span class="o">|</span> <span class="n">_index</span>   <span class="o">|</span> <span class="n">_sort</span>   <span class="o">|</span>
<span class="o">|-------------+------------+----------+---------|</span>
<span class="o">|</span> <span class="n">Amber</span>       <span class="o">|</span> <span class="n">Duke</span>       <span class="o">|</span> <span class="n">accounts</span> <span class="o">|</span> <span class="o">-</span><span class="mi">2</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">Hattie</span>      <span class="o">|</span> <span class="n">Bond</span>       <span class="o">|</span> <span class="n">accounts</span> <span class="o">|</span> <span class="o">-</span><span class="mi">2</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">Nanette</span>     <span class="o">|</span> <span class="n">Bates</span>      <span class="o">|</span> <span class="n">accounts</span> <span class="o">|</span> <span class="o">-</span><span class="mi">2</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">Dale</span>        <span class="o">|</span> <span class="n">Adams</span>      <span class="o">|</span> <span class="n">accounts</span> <span class="o">|</span> <span class="o">-</span><span class="mi">2</span>      <span class="o">|</span>
<span class="o">+-------------+------------+----------+---------+</span>
</pre></div>
</div>
</section>
<section id="example-3-using-field-alias">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">Example 3: Using Field Alias</a><a class="headerlink" href="#example-3-using-field-alias" title="Link to this heading">¶</a></h3>
<p>Alias is often used to make your query more readable by giving your field a shorter name.</p>
<p>SQL query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">_plugins</span><span class="o">/</span><span class="n">_sql</span>
<span class="p">{</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="s2">&quot;SELECT account_number AS num FROM accounts&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Explain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;from&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
  <span class="s2">&quot;_source&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;includes&quot;</span> <span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;account_number&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;excludes&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Result set:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>num</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
</tr>
<tr class="row-even"><td><p>13</p></td>
</tr>
<tr class="row-odd"><td><p>18</p></td>
</tr>
</tbody>
</table>
</section>
<section id="example-4-selecting-distinct-fields">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">Example 4: Selecting Distinct Fields</a><a class="headerlink" href="#example-4-selecting-distinct-fields" title="Link to this heading">¶</a></h3>
<p>By default, <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">ALL</span></code> takes effect to return all rows. <code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code> is useful when you want to de-duplicate and get unique field value. You can provide one or more field names (‘DISTINCT <a href="#id2"><span class="problematic" id="id3">*</span></a>’ is not supported yet).</p>
<p>SQL query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">_plugins</span><span class="o">/</span><span class="n">_sql</span>
<span class="p">{</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="s2">&quot;SELECT DISTINCT age FROM accounts&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Explain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;from&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;_source&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;includes&quot;</span> <span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;age&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;excludes&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
  <span class="p">},</span>
  <span class="s2">&quot;stored_fields&quot;</span> <span class="p">:</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span>
  <span class="s2">&quot;aggregations&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;age&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;terms&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;field&quot;</span> <span class="p">:</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span>
        <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
        <span class="s2">&quot;min_doc_count&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;shard_min_doc_count&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;show_term_doc_count_error&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
        <span class="s2">&quot;order&quot;</span> <span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="s2">&quot;_count&quot;</span> <span class="p">:</span> <span class="s2">&quot;desc&quot;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s2">&quot;_key&quot;</span> <span class="p">:</span> <span class="s2">&quot;asc&quot;</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Result set:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>age</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>28</p></td>
</tr>
<tr class="row-odd"><td><p>32</p></td>
</tr>
<tr class="row-even"><td><p>33</p></td>
</tr>
<tr class="row-odd"><td><p>36</p></td>
</tr>
</tbody>
</table>
<p>In fact your can use any expression in a <code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code> clause as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="n">DISTINCT</span> <span class="n">SUBSTRING</span><span class="p">(</span><span class="n">lastname</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">accounts</span><span class="p">;</span>
<span class="n">fetched</span> <span class="n">rows</span> <span class="o">/</span> <span class="n">total</span> <span class="n">rows</span> <span class="o">=</span> <span class="mi">3</span><span class="o">/</span><span class="mi">3</span>
<span class="o">+-----------------------------+</span>
<span class="o">|</span> <span class="n">SUBSTRING</span><span class="p">(</span><span class="n">lastname</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>   <span class="o">|</span>
<span class="o">|-----------------------------|</span>
<span class="o">|</span> <span class="n">A</span>                           <span class="o">|</span>
<span class="o">|</span> <span class="n">B</span>                           <span class="o">|</span>
<span class="o">|</span> <span class="n">D</span>                           <span class="o">|</span>
<span class="o">+-----------------------------+</span>
</pre></div>
</div>
</section>
</section>
<section id="from">
<h2><a class="toc-backref" href="#id22" role="doc-backlink">FROM</a><a class="headerlink" href="#from" title="Link to this heading">¶</a></h2>
<section id="id4">
<h3><a class="toc-backref" href="#id23" role="doc-backlink">Description</a><a class="headerlink" href="#id4" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">FROM</span></code> clause specifies OpenSearch index where the data should be retrieved from. You’ve seen how to specify a single index in FROM clause in last section. Here we provide examples for more use cases.</p>
<p>Subquery in <code class="docutils literal notranslate"><span class="pre">FROM</span></code> clause is also supported. Please check out the documentation for more details.</p>
</section>
<section id="id5">
<h3><a class="toc-backref" href="#id24" role="doc-backlink">Syntax</a><a class="headerlink" href="#id5" title="Link to this heading">¶</a></h3>
<p>Rule <code class="docutils literal notranslate"><span class="pre">tableName</span></code>:</p>
<img alt="../../../_images/tableName.png" src="../../../_images/tableName.png" />
</section>
<section id="example-1-using-index-alias">
<h3><a class="toc-backref" href="#id25" role="doc-backlink">Example 1: Using Index Alias</a><a class="headerlink" href="#example-1-using-index-alias" title="Link to this heading">¶</a></h3>
<p>Similarly you can give index in <code class="docutils literal notranslate"><span class="pre">FROM</span></code> clause an alias and use it across clauses in query.</p>
<p>SQL query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">_plugins</span><span class="o">/</span><span class="n">_sql</span>
<span class="p">{</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="s2">&quot;SELECT acc.account_number FROM accounts acc&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="example-2-selecting-from-multiple-indices-by-index-pattern">
<h3><a class="toc-backref" href="#id26" role="doc-backlink">Example 2: Selecting From Multiple Indices by Index Pattern</a><a class="headerlink" href="#example-2-selecting-from-multiple-indices-by-index-pattern" title="Link to this heading">¶</a></h3>
<p>Alternatively you can query from multiple indices of similar names by index pattern. This is very convenient for indices created by Logstash index template with date as suffix.</p>
<p>SQL query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">_plugins</span><span class="o">/</span><span class="n">_sql</span>
<span class="p">{</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="s2">&quot;SELECT account_number FROM account*&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="example-3-deprecating-selecting-from-specific-index-type">
<h3><a class="toc-backref" href="#id27" role="doc-backlink">Example 3: [Deprecating] Selecting From Specific Index Type</a><a class="headerlink" href="#example-3-deprecating-selecting-from-specific-index-type" title="Link to this heading">¶</a></h3>
<p>You can also specify type name explicitly though this has been deprecated in later OpenSearch version.</p>
<p>SQL query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">_plugins</span><span class="o">/</span><span class="n">_sql</span>
<span class="p">{</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="s2">&quot;SELECT account_number FROM accounts/account&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="where">
<h2><a class="toc-backref" href="#id28" role="doc-backlink">WHERE</a><a class="headerlink" href="#where" title="Link to this heading">¶</a></h2>
<section id="id6">
<h3><a class="toc-backref" href="#id29" role="doc-backlink">Description</a><a class="headerlink" href="#id6" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">WHERE</span></code> clause specifies only OpenSearch documents that meet the criteria should be affected. It consists of predicates that uses <code class="docutils literal notranslate"><span class="pre">=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">IN</span></code>, <code class="docutils literal notranslate"><span class="pre">BETWEEN</span></code>, <code class="docutils literal notranslate"><span class="pre">LIKE</span></code>, <code class="docutils literal notranslate"><span class="pre">IS</span> <span class="pre">NULL</span></code> or <code class="docutils literal notranslate"><span class="pre">IS</span> <span class="pre">NOT</span> <span class="pre">NULL</span></code>. These predicates can be combined by logical operator <code class="docutils literal notranslate"><span class="pre">NOT</span></code>, <code class="docutils literal notranslate"><span class="pre">AND</span></code> or <code class="docutils literal notranslate"><span class="pre">OR</span></code> to build more complex expression.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">LIKE</span></code> and other full text search topics, please refer to Full Text Search documentation.</p>
<p>Besides SQL query, WHERE clause can also be used in SQL statement such as <code class="docutils literal notranslate"><span class="pre">DELETE</span></code>. Please refer to Data Manipulation Language documentation for details.</p>
</section>
<section id="example-1-comparison-operators">
<h3><a class="toc-backref" href="#id30" role="doc-backlink">Example 1: Comparison Operators</a><a class="headerlink" href="#example-1-comparison-operators" title="Link to this heading">¶</a></h3>
<p>Basic comparison operators, such as <code class="docutils literal notranslate"><span class="pre">=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>, can work for number, string or date. <code class="docutils literal notranslate"><span class="pre">IN</span></code> and <code class="docutils literal notranslate"><span class="pre">BETWEEN</span></code> is convenient for comparison with multiple values or a range.</p>
<p>SQL query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">_plugins</span><span class="o">/</span><span class="n">_sql</span>
<span class="p">{</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT account_number</span>
<span class="s2">        FROM accounts</span>
<span class="s2">        WHERE account_number = 1</span>
<span class="s2">        &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Explain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;from&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;bool&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;filter&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;bool&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;must&quot;</span> <span class="p">:</span> <span class="p">[</span>
              <span class="p">{</span>
                <span class="s2">&quot;term&quot;</span> <span class="p">:</span> <span class="p">{</span>
                  <span class="s2">&quot;account_number&quot;</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;value&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="s2">&quot;boost&quot;</span> <span class="p">:</span> <span class="mf">1.0</span>
                  <span class="p">}</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;adjust_pure_negative&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
            <span class="s2">&quot;boost&quot;</span> <span class="p">:</span> <span class="mf">1.0</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="s2">&quot;adjust_pure_negative&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;boost&quot;</span> <span class="p">:</span> <span class="mf">1.0</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">&quot;_source&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;includes&quot;</span> <span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;account_number&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;excludes&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Result set:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>account_number</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
</tr>
</tbody>
</table>
</section>
<section id="example-2-missing-fields">
<h3><a class="toc-backref" href="#id31" role="doc-backlink">Example 2: Missing Fields</a><a class="headerlink" href="#example-2-missing-fields" title="Link to this heading">¶</a></h3>
<p>As NoSQL database, OpenSearch allows for flexible schema that documents in an index may have different fields. In this case, you can use <code class="docutils literal notranslate"><span class="pre">IS</span> <span class="pre">NULL</span></code> or <code class="docutils literal notranslate"><span class="pre">IS</span> <span class="pre">NOT</span> <span class="pre">NULL</span></code> to retrieve missing fields or existing fields only.</p>
<p>Note that for now we don’t differentiate missing field and field set to <code class="docutils literal notranslate"><span class="pre">NULL</span></code> explicitly.</p>
<p>SQL query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">_plugins</span><span class="o">/</span><span class="n">_sql</span>
<span class="p">{</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT account_number, employer</span>
<span class="s2">        FROM accounts</span>
<span class="s2">        WHERE employer IS NULL</span>
<span class="s2">        &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Explain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;from&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;bool&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;filter&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;bool&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;must&quot;</span> <span class="p">:</span> <span class="p">[</span>
              <span class="p">{</span>
                <span class="s2">&quot;bool&quot;</span> <span class="p">:</span> <span class="p">{</span>
                  <span class="s2">&quot;must_not&quot;</span> <span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                      <span class="s2">&quot;exists&quot;</span> <span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;field&quot;</span> <span class="p">:</span> <span class="s2">&quot;employer.keyword&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;boost&quot;</span> <span class="p">:</span> <span class="mf">1.0</span>
                      <span class="p">}</span>
                    <span class="p">}</span>
                  <span class="p">],</span>
                  <span class="s2">&quot;adjust_pure_negative&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
                  <span class="s2">&quot;boost&quot;</span> <span class="p">:</span> <span class="mf">1.0</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;adjust_pure_negative&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
            <span class="s2">&quot;boost&quot;</span> <span class="p">:</span> <span class="mf">1.0</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="s2">&quot;adjust_pure_negative&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
      <span class="s2">&quot;boost&quot;</span> <span class="p">:</span> <span class="mf">1.0</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">&quot;_source&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;includes&quot;</span> <span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;account_number&quot;</span><span class="p">,</span>
      <span class="s2">&quot;employer&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;excludes&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Result set:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>account_number</p></th>
<th class="head"><p>employer</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>18</p></td>
<td><p>null</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="group-by">
<h2><a class="toc-backref" href="#id32" role="doc-backlink">GROUP BY</a><a class="headerlink" href="#group-by" title="Link to this heading">¶</a></h2>
<section id="id7">
<h3><a class="toc-backref" href="#id33" role="doc-backlink">Description</a><a class="headerlink" href="#id7" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> groups documents with same field value into buckets. It is often used along with aggregation functions to aggregate inside each bucket. Please refer to SQL Functions documentation for more details.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> clause is applied before <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> clause.</p>
</section>
<section id="example-1-grouping-by-fields">
<h3><a class="toc-backref" href="#id34" role="doc-backlink">Example 1: Grouping by Fields</a><a class="headerlink" href="#example-1-grouping-by-fields" title="Link to this heading">¶</a></h3>
<p>SQL query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">_plugins</span><span class="o">/</span><span class="n">_sql</span>
<span class="p">{</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT age</span>
<span class="s2">        FROM accounts</span>
<span class="s2">        GROUP BY age</span>
<span class="s2">        &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Explain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;from&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;_source&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;includes&quot;</span> <span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;age&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;excludes&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
  <span class="p">},</span>
  <span class="s2">&quot;stored_fields&quot;</span> <span class="p">:</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span>
  <span class="s2">&quot;aggregations&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;age&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;terms&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;field&quot;</span> <span class="p">:</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span>
        <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
        <span class="s2">&quot;min_doc_count&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;shard_min_doc_count&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;show_term_doc_count_error&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
        <span class="s2">&quot;order&quot;</span> <span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="s2">&quot;_count&quot;</span> <span class="p">:</span> <span class="s2">&quot;desc&quot;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s2">&quot;_key&quot;</span> <span class="p">:</span> <span class="s2">&quot;asc&quot;</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Result set:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>age</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>28</p></td>
</tr>
<tr class="row-odd"><td><p>32</p></td>
</tr>
<tr class="row-even"><td><p>33</p></td>
</tr>
<tr class="row-odd"><td><p>36</p></td>
</tr>
</tbody>
</table>
</section>
<section id="example-2-grouping-by-field-alias">
<h3><a class="toc-backref" href="#id35" role="doc-backlink">Example 2: Grouping by Field Alias</a><a class="headerlink" href="#example-2-grouping-by-field-alias" title="Link to this heading">¶</a></h3>
<p>Field alias is accessible in <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> clause.</p>
<p>SQL query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">_plugins</span><span class="o">/</span><span class="n">_sql</span>
<span class="p">{</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT account_number AS num</span>
<span class="s2">        FROM accounts</span>
<span class="s2">        GROUP BY num</span>
<span class="s2">        &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Explain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;from&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;_source&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;includes&quot;</span> <span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;account_number&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;excludes&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
  <span class="p">},</span>
  <span class="s2">&quot;stored_fields&quot;</span> <span class="p">:</span> <span class="s2">&quot;account_number&quot;</span><span class="p">,</span>
  <span class="s2">&quot;aggregations&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;num&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;terms&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;field&quot;</span> <span class="p">:</span> <span class="s2">&quot;account_number&quot;</span><span class="p">,</span>
        <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
        <span class="s2">&quot;min_doc_count&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;shard_min_doc_count&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;show_term_doc_count_error&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
        <span class="s2">&quot;order&quot;</span> <span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="s2">&quot;_count&quot;</span> <span class="p">:</span> <span class="s2">&quot;desc&quot;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s2">&quot;_key&quot;</span> <span class="p">:</span> <span class="s2">&quot;asc&quot;</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Result set:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>num</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
</tr>
<tr class="row-even"><td><p>13</p></td>
</tr>
<tr class="row-odd"><td><p>18</p></td>
</tr>
</tbody>
</table>
</section>
<section id="example-3-grouping-by-ordinal">
<h3><a class="toc-backref" href="#id36" role="doc-backlink">Example 3: Grouping by Ordinal</a><a class="headerlink" href="#example-3-grouping-by-ordinal" title="Link to this heading">¶</a></h3>
<p>Alternatively field ordinal in <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> clause can be used too. However this is not recommended because your <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> clause depends on fields in <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> clause and require to change accordingly.</p>
<p>SQL query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">_plugins</span><span class="o">/</span><span class="n">_sql</span>
<span class="p">{</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT age</span>
<span class="s2">        FROM accounts</span>
<span class="s2">        GROUP BY 1</span>
<span class="s2">        &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Explain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;from&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;_source&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;includes&quot;</span> <span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;age&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;excludes&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
  <span class="p">},</span>
  <span class="s2">&quot;stored_fields&quot;</span> <span class="p">:</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span>
  <span class="s2">&quot;aggregations&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;age&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;terms&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;field&quot;</span> <span class="p">:</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span>
        <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
        <span class="s2">&quot;min_doc_count&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;shard_min_doc_count&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;show_term_doc_count_error&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
        <span class="s2">&quot;order&quot;</span> <span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="s2">&quot;_count&quot;</span> <span class="p">:</span> <span class="s2">&quot;desc&quot;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s2">&quot;_key&quot;</span> <span class="p">:</span> <span class="s2">&quot;asc&quot;</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Result set:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>age</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>28</p></td>
</tr>
<tr class="row-odd"><td><p>32</p></td>
</tr>
<tr class="row-even"><td><p>33</p></td>
</tr>
<tr class="row-odd"><td><p>36</p></td>
</tr>
</tbody>
</table>
</section>
<section id="example-4-grouping-by-scalar-function">
<h3><a class="toc-backref" href="#id37" role="doc-backlink">Example 4: Grouping by Scalar Function</a><a class="headerlink" href="#example-4-grouping-by-scalar-function" title="Link to this heading">¶</a></h3>
<p>Scalar function can be used in <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> clause and it’s required to be present in <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> clause too.</p>
<p>SQL query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">_plugins</span><span class="o">/</span><span class="n">_sql</span>
<span class="p">{</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT ABS(age) AS a</span>
<span class="s2">        FROM accounts</span>
<span class="s2">        GROUP BY ABS(age)</span>
<span class="s2">        &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Explain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;from&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;_source&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;includes&quot;</span> <span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;script&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;excludes&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
  <span class="p">},</span>
  <span class="s2">&quot;stored_fields&quot;</span> <span class="p">:</span> <span class="s2">&quot;abs(age)&quot;</span><span class="p">,</span>
  <span class="s2">&quot;script_fields&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;abs(age)&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;script&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;source&quot;</span> <span class="p">:</span> <span class="s2">&quot;def abs_1 = Math.abs(doc[&#39;age&#39;].value);return abs_1;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lang&quot;</span> <span class="p">:</span> <span class="s2">&quot;painless&quot;</span>
      <span class="p">},</span>
      <span class="s2">&quot;ignore_failure&quot;</span> <span class="p">:</span> <span class="n">false</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">&quot;aggregations&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;abs(age)&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;terms&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;script&quot;</span> <span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;source&quot;</span> <span class="p">:</span> <span class="s2">&quot;def abs_1 = Math.abs(doc[&#39;age&#39;].value);return abs_1;&quot;</span><span class="p">,</span>
          <span class="s2">&quot;lang&quot;</span> <span class="p">:</span> <span class="s2">&quot;painless&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
        <span class="s2">&quot;min_doc_count&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;shard_min_doc_count&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;show_term_doc_count_error&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
        <span class="s2">&quot;order&quot;</span> <span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="s2">&quot;_count&quot;</span> <span class="p">:</span> <span class="s2">&quot;desc&quot;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s2">&quot;_key&quot;</span> <span class="p">:</span> <span class="s2">&quot;asc&quot;</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Result set:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>a</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>28.0</p></td>
</tr>
<tr class="row-odd"><td><p>32.0</p></td>
</tr>
<tr class="row-even"><td><p>33.0</p></td>
</tr>
<tr class="row-odd"><td><p>36.0</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="having">
<h2><a class="toc-backref" href="#id38" role="doc-backlink">HAVING</a><a class="headerlink" href="#having" title="Link to this heading">¶</a></h2>
<section id="id8">
<h3><a class="toc-backref" href="#id39" role="doc-backlink">Description</a><a class="headerlink" href="#id8" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">HAVING</span></code> clause filters result from <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> clause by predicate(s). Because of this, aggregation function, even different from those on <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> clause, can be used in predicate.</p>
</section>
<section id="example">
<h3><a class="toc-backref" href="#id40" role="doc-backlink">Example</a><a class="headerlink" href="#example" title="Link to this heading">¶</a></h3>
<p>SQL query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">_plugins</span><span class="o">/</span><span class="n">_sql</span>
<span class="p">{</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT age, MAX(balance)</span>
<span class="s2">        FROM accounts</span>
<span class="s2">        GROUP BY age</span>
<span class="s2">        HAVING MIN(balance) &gt; 10000</span>
<span class="s2">        &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Explain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;from&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;_source&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;includes&quot;</span> <span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;age&quot;</span><span class="p">,</span>
      <span class="s2">&quot;MAX&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;excludes&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
  <span class="p">},</span>
  <span class="s2">&quot;stored_fields&quot;</span> <span class="p">:</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span>
  <span class="s2">&quot;aggregations&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;age&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;terms&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;field&quot;</span> <span class="p">:</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span>
        <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
        <span class="s2">&quot;min_doc_count&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;shard_min_doc_count&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;show_term_doc_count_error&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
        <span class="s2">&quot;order&quot;</span> <span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="s2">&quot;_count&quot;</span> <span class="p">:</span> <span class="s2">&quot;desc&quot;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s2">&quot;_key&quot;</span> <span class="p">:</span> <span class="s2">&quot;asc&quot;</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="s2">&quot;aggregations&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;MAX_0&quot;</span> <span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;max&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;field&quot;</span> <span class="p">:</span> <span class="s2">&quot;balance&quot;</span>
          <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;min_0&quot;</span> <span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;min&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;field&quot;</span> <span class="p">:</span> <span class="s2">&quot;balance&quot;</span>
          <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;bucket_filter&quot;</span> <span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;bucket_selector&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;buckets_path&quot;</span> <span class="p">:</span> <span class="p">{</span>
              <span class="s2">&quot;min_0&quot;</span> <span class="p">:</span> <span class="s2">&quot;min_0&quot;</span><span class="p">,</span>
              <span class="s2">&quot;MAX_0&quot;</span> <span class="p">:</span> <span class="s2">&quot;MAX_0&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;script&quot;</span> <span class="p">:</span> <span class="p">{</span>
              <span class="s2">&quot;source&quot;</span> <span class="p">:</span> <span class="s2">&quot;params.min_0 &gt; 10000&quot;</span><span class="p">,</span>
              <span class="s2">&quot;lang&quot;</span> <span class="p">:</span> <span class="s2">&quot;painless&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;gap_policy&quot;</span> <span class="p">:</span> <span class="s2">&quot;skip&quot;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Result set:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>age</p></th>
<th class="head"><p>MAX(balance)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>28</p></td>
<td><p>32838</p></td>
</tr>
<tr class="row-odd"><td><p>32</p></td>
<td><p>39225</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="order-by">
<h2><a class="toc-backref" href="#id41" role="doc-backlink">ORDER BY</a><a class="headerlink" href="#order-by" title="Link to this heading">¶</a></h2>
<section id="id9">
<h3><a class="toc-backref" href="#id42" role="doc-backlink">Description</a><a class="headerlink" href="#id9" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> clause specifies which fields used to sort the result and in which direction.</p>
</section>
<section id="example-1-ordering-by-fields">
<h3><a class="toc-backref" href="#id43" role="doc-backlink">Example 1: Ordering by Fields</a><a class="headerlink" href="#example-1-ordering-by-fields" title="Link to this heading">¶</a></h3>
<p>Besides regular field names, ordinal, alias or scalar function can also be used similarly as in <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>. <code class="docutils literal notranslate"><span class="pre">ASC</span></code> (by default) or <code class="docutils literal notranslate"><span class="pre">DESC</span></code> can be appended to indicate sorting in ascending or descending order.</p>
<p>SQL query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">_plugins</span><span class="o">/</span><span class="n">_sql</span>
<span class="p">{</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="s2">&quot;SELECT account_number FROM accounts ORDER BY account_number DESC&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Explain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;from&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
  <span class="s2">&quot;_source&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;includes&quot;</span> <span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;account_number&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;excludes&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
  <span class="p">},</span>
  <span class="s2">&quot;sort&quot;</span> <span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;account_number&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;order&quot;</span> <span class="p">:</span> <span class="s2">&quot;desc&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Result set:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>account_number</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>18</p></td>
</tr>
<tr class="row-odd"><td><p>13</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
</tr>
</tbody>
</table>
</section>
<section id="example-2-specifying-order-for-null">
<h3><a class="toc-backref" href="#id44" role="doc-backlink">Example 2: Specifying Order for Null</a><a class="headerlink" href="#example-2-specifying-order-for-null" title="Link to this heading">¶</a></h3>
<p>Additionally you can specify if documents with missing field be put first or last. The default behavior of OpenSearch is to return nulls or missing last. You can make them present before non-nulls by using <code class="docutils literal notranslate"><span class="pre">IS</span> <span class="pre">NOT</span> <span class="pre">NULL</span></code>.</p>
<p>SQL query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">_plugins</span><span class="o">/</span><span class="n">_sql</span>
<span class="p">{</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT employer</span>
<span class="s2">        FROM accounts</span>
<span class="s2">        ORDER BY employer IS NOT NULL</span>
<span class="s2">        &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Explain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;from&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
  <span class="s2">&quot;_source&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;includes&quot;</span> <span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;employer&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;excludes&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
  <span class="p">},</span>
  <span class="s2">&quot;sort&quot;</span> <span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;employer.keyword&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;order&quot;</span> <span class="p">:</span> <span class="s2">&quot;asc&quot;</span><span class="p">,</span>
        <span class="s2">&quot;missing&quot;</span> <span class="p">:</span> <span class="s2">&quot;_first&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Result set:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>employer</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>null</p></td>
</tr>
<tr class="row-odd"><td><p>Netagy</p></td>
</tr>
<tr class="row-even"><td><p>Pyrami</p></td>
</tr>
<tr class="row-odd"><td><p>Quility</p></td>
</tr>
</tbody>
</table>
<p>Note that the example above is essentially sorting on a predicate expression. In this case, nulls are put first because it’s evaluated to false (0), though all the rest are evaluated to true and still in random order. If you want to specify order for both nulls and non-nulls, <code class="docutils literal notranslate"><span class="pre">NULLS</span> <span class="pre">FIRST</span></code> or <code class="docutils literal notranslate"><span class="pre">NULLS</span> <span class="pre">LAST</span></code> in SQL standard can help. Basically, it allows you to specify an independent order for nulls along with <code class="docutils literal notranslate"><span class="pre">ASC</span></code> or <code class="docutils literal notranslate"><span class="pre">DESC</span></code> keyword:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="n">employer</span> <span class="n">FROM</span> <span class="n">accounts</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">employer</span> <span class="n">ASC</span> <span class="n">NULLS</span> <span class="n">LAST</span><span class="p">;</span>
<span class="n">fetched</span> <span class="n">rows</span> <span class="o">/</span> <span class="n">total</span> <span class="n">rows</span> <span class="o">=</span> <span class="mi">4</span><span class="o">/</span><span class="mi">4</span>
<span class="o">+------------+</span>
<span class="o">|</span> <span class="n">employer</span>   <span class="o">|</span>
<span class="o">|------------|</span>
<span class="o">|</span> <span class="n">Netagy</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">Pyrami</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">Quility</span>    <span class="o">|</span>
<span class="o">|</span> <span class="n">null</span>       <span class="o">|</span>
<span class="o">+------------+</span>
</pre></div>
</div>
<p>The sorting rule can be summarized as follows:</p>
<ul class="simple">
<li><p>Without <code class="docutils literal notranslate"><span class="pre">NULLS</span></code> clause</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ASC</span></code>: sort non-nulls in ascending order and put nulls first</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DESC</span></code>: sort non-nulls in descending order and put nulls last</p></li>
</ul>
</li>
<li><p>With <code class="docutils literal notranslate"><span class="pre">NULLS</span></code> clause: just use the nulls order given</p></li>
</ul>
<p>Here is another example for sort in descending order without <code class="docutils literal notranslate"><span class="pre">NULLS</span></code> clause:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="n">employer</span> <span class="n">FROM</span> <span class="n">accounts</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">employer</span> <span class="n">DESC</span><span class="p">;</span>
<span class="n">fetched</span> <span class="n">rows</span> <span class="o">/</span> <span class="n">total</span> <span class="n">rows</span> <span class="o">=</span> <span class="mi">4</span><span class="o">/</span><span class="mi">4</span>
<span class="o">+------------+</span>
<span class="o">|</span> <span class="n">employer</span>   <span class="o">|</span>
<span class="o">|------------|</span>
<span class="o">|</span> <span class="n">Quility</span>    <span class="o">|</span>
<span class="o">|</span> <span class="n">Pyrami</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">Netagy</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">null</span>       <span class="o">|</span>
<span class="o">+------------+</span>
</pre></div>
</div>
</section>
<section id="example-3-ordering-by-aggregate-functions">
<h3><a class="toc-backref" href="#id45" role="doc-backlink">Example 3: Ordering by Aggregate Functions</a><a class="headerlink" href="#example-3-ordering-by-aggregate-functions" title="Link to this heading">¶</a></h3>
<p>Aggregate functions are allowed to be used in <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> clause. You can reference it by same function call or its alias or ordinal in select list:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="n">gender</span><span class="p">,</span> <span class="n">MAX</span><span class="p">(</span><span class="n">age</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">accounts</span> <span class="n">GROUP</span> <span class="n">BY</span> <span class="n">gender</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">MAX</span><span class="p">(</span><span class="n">age</span><span class="p">)</span> <span class="n">DESC</span><span class="p">;</span>
<span class="n">fetched</span> <span class="n">rows</span> <span class="o">/</span> <span class="n">total</span> <span class="n">rows</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="mi">2</span>
<span class="o">+----------+------------+</span>
<span class="o">|</span> <span class="n">gender</span>   <span class="o">|</span> <span class="n">MAX</span><span class="p">(</span><span class="n">age</span><span class="p">)</span>   <span class="o">|</span>
<span class="o">|----------+------------|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">36</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">F</span>        <span class="o">|</span> <span class="mi">28</span>         <span class="o">|</span>
<span class="o">+----------+------------+</span>
</pre></div>
</div>
<p>Even if it’s not present in <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> clause, it can be also used as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="n">gender</span><span class="p">,</span> <span class="n">MIN</span><span class="p">(</span><span class="n">age</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">accounts</span> <span class="n">GROUP</span> <span class="n">BY</span> <span class="n">gender</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">MAX</span><span class="p">(</span><span class="n">age</span><span class="p">)</span> <span class="n">DESC</span><span class="p">;</span>
<span class="n">fetched</span> <span class="n">rows</span> <span class="o">/</span> <span class="n">total</span> <span class="n">rows</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="mi">2</span>
<span class="o">+----------+------------+</span>
<span class="o">|</span> <span class="n">gender</span>   <span class="o">|</span> <span class="n">MIN</span><span class="p">(</span><span class="n">age</span><span class="p">)</span>   <span class="o">|</span>
<span class="o">|----------+------------|</span>
<span class="o">|</span> <span class="n">M</span>        <span class="o">|</span> <span class="mi">32</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">F</span>        <span class="o">|</span> <span class="mi">28</span>         <span class="o">|</span>
<span class="o">+----------+------------+</span>
</pre></div>
</div>
</section>
</section>
<section id="limit">
<h2><a class="toc-backref" href="#id46" role="doc-backlink">LIMIT</a><a class="headerlink" href="#limit" title="Link to this heading">¶</a></h2>
<section id="id10">
<h3><a class="toc-backref" href="#id47" role="doc-backlink">Description</a><a class="headerlink" href="#id10" title="Link to this heading">¶</a></h3>
<p>Mostly specifying maximum number of documents returned is necessary to prevent fetching large amount of data into memory. <cite>LIMIT</cite> clause is helpful in this case. Basically the limit is set to the query planning, so different LIMIT and OFFSET might end up unpredictable subset in the results. Thus it is suggested to use order by in query with limit keyword to enforce a fixed ordering in the result set.</p>
</section>
<section id="example-1-limiting-result-size">
<h3><a class="toc-backref" href="#id48" role="doc-backlink">Example 1: Limiting Result Size</a><a class="headerlink" href="#example-1-limiting-result-size" title="Link to this heading">¶</a></h3>
<p>Given a positive number, <code class="docutils literal notranslate"><span class="pre">LIMIT</span></code> uses it as page size to fetch result of that size at most.</p>
<p>SQL query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">_plugins</span><span class="o">/</span><span class="n">_sql</span>
<span class="p">{</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT account_number</span>
<span class="s2">        FROM accounts</span>
<span class="s2">        ORDER BY account_number LIMIT 1</span>
<span class="s2">        &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Explain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;from&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s2">&quot;_source&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;includes&quot;</span> <span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;account_number&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;excludes&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
  <span class="p">},</span>
  <span class="s2">&quot;sort&quot;</span> <span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;account_number&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;order&quot;</span> <span class="p">:</span> <span class="s2">&quot;asc&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Result set:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>account_number</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
</tr>
</tbody>
</table>
</section>
<section id="example-2-fetching-at-offset">
<h3><a class="toc-backref" href="#id49" role="doc-backlink">Example 2: Fetching at Offset</a><a class="headerlink" href="#example-2-fetching-at-offset" title="Link to this heading">¶</a></h3>
<p>Offset position can be given as first argument to indicate where to start fetching. This can be used as simple pagination solution though it’s inefficient on large index. Generally <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> is required in this case to ensure the same order between pages.</p>
<p>SQL query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">_plugins</span><span class="o">/</span><span class="n">_sql</span>
<span class="p">{</span>
  <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT account_number</span>
<span class="s2">        FROM accounts</span>
<span class="s2">        ORDER BY account_number LIMIT 1, 1</span>
<span class="s2">        &quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Explain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;from&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s2">&quot;size&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s2">&quot;_source&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;includes&quot;</span> <span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;account_number&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;excludes&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
  <span class="p">},</span>
  <span class="s2">&quot;sort&quot;</span> <span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;account_number&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;order&quot;</span> <span class="p">:</span> <span class="s2">&quot;asc&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Result set:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>account_number</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>6</p></td>
</tr>
</tbody>
</table>
<p>Offset position can be given following the OFFSET keyword as well, here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">od</span> <span class="n">SELECT</span> <span class="n">age</span> <span class="n">FROM</span> <span class="n">accounts</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">age</span> <span class="n">LIMIT</span> <span class="mi">2</span> <span class="n">OFFSET</span> <span class="mi">1</span>
<span class="n">fetched</span> <span class="n">rows</span> <span class="o">/</span> <span class="n">total</span> <span class="n">rows</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="mi">2</span>
<span class="o">+-------+</span>
<span class="o">|</span> <span class="n">age</span>   <span class="o">|</span>
<span class="o">|-------|</span>
<span class="o">|</span> <span class="mi">32</span>    <span class="o">|</span>
<span class="o">|</span> <span class="mi">33</span>    <span class="o">|</span>
<span class="o">+-------+</span>
</pre></div>
</div>
</section>
<section id="limitation">
<h3><a class="toc-backref" href="#id50" role="doc-backlink">Limitation</a><a class="headerlink" href="#limitation" title="Link to this heading">¶</a></h3>
<p>Generally, sort plan is pushed down into the OpenSearch DSL in plan optimization, but note that if a query has complex sorting, like sort expression, which would not be pushed down during optimization (see <a class="reference external" href="../optimization/optimization.rst">Optimizations</a> for details), but computed in local memory. However, the engine fetches the index of a default size that is set in plugin setting (See <cite>Settings &lt;../admin/settings.rst&gt;</cite> plugins.query.size_limit for details). Therefore, the result might not be absolutely correct if the index size is larger than the default size of index scan. For example, the engine has a index scan size of 200 and the index size is 500. Then a query with limit 300 can only fetch 200 rows of the index, compute and return the sorted result with 200 rows, while the rest 300 rows of the index are ignored and would not be fetched into the engine. To get an absolutely correct result, it is suggested to set the query size limit to a larger value before run the query.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">sql-docs</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, josh.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../../../_sources/docs/user/dql/basics.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>